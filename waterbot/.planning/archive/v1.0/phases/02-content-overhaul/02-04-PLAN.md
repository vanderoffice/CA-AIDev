---
phase: 02-content-overhaul
plan: 04
type: execute
---

<objective>
Expand and rewrite gap filler, additional topics, final topics, and small systems content — the highest-volume group with the thinnest content needing substantial enhancement alongside URL injection and "Take Action" sections. This completes Phase 2.

Purpose: Gap filler docs (avg 440 chars) are currently bullet-point outlines that provide weak RAG retrieval. Expanding them with URLs and "Take Action" sections transforms them from skeletal placeholders into actionable knowledge base entries.
Output: 8 updated JSON files (4 batch + 4 individual) with expanded content, inline URLs, and "Take Action" sections. Phase 2 complete.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/02-content-overhaul/02-01-SUMMARY.md
@.planning/phases/02-content-overhaul/02-02-SUMMARY.md
@.planning/phases/02-content-overhaul/02-03-SUMMARY.md

# URL registry:
@rag-content/waterbot/url_registry.json

# Files to rewrite (batch):
@rag-content/waterbot/batch_gap_filler.json
@rag-content/waterbot/batch_additional_topics.json
@rag-content/waterbot/batch_final_topics.json
@rag-content/waterbot/batch_small_systems.json

# Files to update (individual):
@rag-content/waterbot/cgp_guide.json
@rag-content/waterbot/igp_guide.json
@rag-content/waterbot/sgma_implementation.json
@rag-content/waterbot/well_permit_requirements.json

**Established patterns from 02-01/02-02/02-03:**
- Inline URLs as markdown hyperlinks (2-5 per doc)
- "## Take Action" section with 3-5 numbered steps + linked URLs
- URL type guides step wording
- Metadata preserved unchanged
- No bare URLs

**Critical context for this plan:**
- batch_gap_filler.json: 40 docs averaging only **440 chars** — these are bullet-point outlines, NOT full articles. They need EXPANSION (target 1,200-1,800 chars) plus URLs and "Take Action"
- batch_additional_topics.json: 16 docs averaging **1,190 chars** — moderate, need URL injection + "Take Action"
- batch_final_topics.json: 12 docs averaging **1,204 chars** — moderate, same treatment
- batch_small_systems.json: 10 docs averaging **1,160 chars** — moderate, same treatment
- Total: 82 topics (highest volume plan, but thinner content per doc)

**Expansion guidelines for thin gap filler docs:**
- Current: bullet lists with 4-6 items under 2-3 headings (~440 chars)
- Target: 2-3 paragraphs + bullet lists + "## Take Action" (~1,200-1,800 chars)
- Add context sentences explaining WHY each point matters for CA water
- Expand "Resources" bullet points into linked references
- Don't over-expand — these are supplemental topics, not primary knowledge base entries
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand and rewrite batch_gap_filler.json (40 docs) + batch_small_systems.json (10 docs)</name>
  <files>rag-content/waterbot/batch_gap_filler.json, rag-content/waterbot/batch_small_systems.json</files>
  <action>
  Load url_registry.json and process both batch files. These docs need EXPANSION, not just URL injection.

  **For gap_filler docs (40 docs, avg 440 chars each):**
  1. For each document, match `metadata.topic` to registry entry
  2. EXPAND the content from bullet-point outline to proper knowledge base entry:
     - Keep existing headings and structure as skeleton
     - Add 1-2 introductory sentences explaining the topic in CA water context
     - Expand bullet points into brief explanatory text where helpful
     - Convert "Resources" bullets into inline markdown links using registry URLs
     - Add `## Take Action` section with 3-5 numbered, linked steps
  3. Target: 1,200-1,800 chars per doc (up from ~440)
  4. Keep metadata unchanged

  Use Python for efficient batch processing:
  - Build registry lookup dict
  - Process all 40 docs in a loop
  - Write updated JSON back to batch_gap_filler.json

  **For small_systems docs (10 docs, avg 1,160 chars each):**
  - These are more substantial — enhance with URLs and "Take Action" (similar to Plans 01-03)
  - Inline links to DDW small system programs, SAFER eligibility, technical assistance
  - "Take Action" should guide small systems: assess needs → check eligibility → apply for funding → find technical assistance

  Write updated JSON back to both files.
  </action>
  <verify>
  Python verification:
  ```python
  import json
  for f in ['batch_gap_filler.json', 'batch_small_systems.json']:
      data = json.load(open(f'rag-content/waterbot/{f}'))
      docs = data if isinstance(data, list) else data.get('documents', [])
      for d in docs:
          content = d['content']
          assert 'http' in content, f"Missing URLs: {d['metadata']['topic']}"
          assert '## Take Action' in content, f"Missing Take Action: {d['metadata']['topic']}"
          assert len(content) >= 800, f"Too short ({len(content)} chars): {d['metadata']['topic']}"
      print(f'{f}: {len(docs)} docs OK, all ≥800 chars')
  ```
  </verify>
  <done>All 50 docs expanded to ≥800 chars with inline URLs and "Take Action" sections. Gap filler docs expanded from ~440 to ~1,200-1,800 chars.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite remaining batch files + individual files, verify all 8 files, finalize Phase 2</name>
  <files>rag-content/waterbot/batch_additional_topics.json, rag-content/waterbot/batch_final_topics.json, rag-content/waterbot/cgp_guide.json, rag-content/waterbot/igp_guide.json, rag-content/waterbot/sgma_implementation.json, rag-content/waterbot/well_permit_requirements.json</files>
  <action>
  **Rewrite 2 batch files (28 docs):**

  batch_additional_topics.json (16 docs) and batch_final_topics.json (12 docs):
  - Match each topic to registry, inject inline URLs, add "## Take Action" sections
  - These are moderate-length docs (~1,200 chars) — enhance with URLs, don't need major expansion
  - Fact-check any specific figures or regulatory references

  **Update 4 individual files:**
  cgp_guide.json, igp_guide.json, sgma_implementation.json, well_permit_requirements.json:
  - Already have URLs — verify against registry, convert bare URLs to markdown links
  - Add "## Take Action" if not present
  - Fact-check permit requirements and implementation timelines

  **Final Phase 2 verification across ALL 33 source files:**
  After completing this plan's 8 files, run a comprehensive check across ALL 33 files modified in Phase 2 (Plans 01-04) to confirm every single topic has been enhanced:
  - All 179 topics have inline markdown URLs
  - All 179 topics have "## Take Action" sections
  - No bare URLs remain anywhere
  - All JSON files valid
  - Report total URL count embedded in content vs registry total (577)
  </action>
  <verify>
  Run full Phase 2 verification across all 33 files:
  ```python
  import json, re, os
  base = 'rag-content/waterbot'
  all_files = [f for f in os.listdir(base) if f.endswith('.json') and f != 'url_registry.json']
  total_topics = 0
  total_links = 0
  missing_action = []
  low_links = []
  for f in sorted(all_files):
      data = json.load(open(os.path.join(base, f)))
      docs = data if isinstance(data, list) else data.get('documents', [])
      for d in docs:
          c = d['content']
          links = re.findall(r'\[([^\]]+)\]\(https?://[^)]+\)', c)
          total_links += len(links)
          total_topics += 1
          if '## Take Action' not in c:
              missing_action.append(d['metadata']['topic'])
          if len(links) < 2:
              low_links.append(f"{d['metadata']['topic']}: {len(links)} links")
  print(f'Total topics: {total_topics}')
  print(f'Total inline links: {total_links}')
  print(f'Missing Take Action: {len(missing_action)}')
  print(f'Low link count (<2): {len(low_links)}')
  if missing_action: print('Missing:', missing_action[:5])
  if low_links: print('Low:', low_links[:5])
  ```
  </verify>
  <done>All 82 topics in this plan enhanced. Full Phase 2 verification: all 179 topics across 33 files have inline URLs and "Take Action" sections. Phase 2 Content Overhaul complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] batch_gap_filler.json: all 40 docs expanded from ~440 to ≥800 chars with URLs
- [ ] batch_small_systems.json: all 10 docs enhanced with URLs and "Take Action"
- [ ] batch_additional_topics.json: all 16 docs enhanced
- [ ] batch_final_topics.json: all 12 docs enhanced
- [ ] All 4 individual files updated
- [ ] **FULL PHASE 2 CHECK**: All 179 topics across all 33 files have inline URLs + "Take Action"
- [ ] No bare URLs remain in any file
- [ ] All JSON files valid
- [ ] Metadata unchanged throughout
</verification>

<success_criteria>

- All 82 topics in this plan enhanced with inline URLs and "Take Action" sections
- Gap filler docs expanded from skeletal outlines to proper entries (≥800 chars)
- Full Phase 2 verification passes: 179/179 topics complete
- Phase 2 Content Overhaul complete — all content ready for DB rebuild (Phase 3)
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-overhaul/02-04-SUMMARY.md` with:
- Phase 2 completion metrics (179 topics, total links embedded, avg content size before/after)
- Summary of fact-check findings (any flagged items)
- Content quality assessment
- Readiness statement for Phase 3 (DB Rebuild)

This is the FINAL plan in Phase 2 — success criteria should include "Phase 2 complete."
</output>
