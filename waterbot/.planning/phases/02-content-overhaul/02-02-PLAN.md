---
phase: 02-content-overhaul
plan: 02
type: execute
---

<objective>
Rewrite programs and public resources content, enhance funding guides with inline URLs and "Take Action" sections — the highest-actionability group since these topics directly guide residents to apply for programs and funding.

Purpose: Programs and funding topics are where actionable links matter most — residents need to know WHERE to apply, WHAT they're eligible for, and HOW to start. This plan makes those pathways explicit.
Output: 9 updated JSON files (2 batch + 7 individual) with inline URLs, fact-checked content, and "Take Action" sections.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 1 context:
@.planning/phases/01-url-registry/01-04-SUMMARY.md

# Prior plan in this phase:
@.planning/phases/02-content-overhaul/02-01-SUMMARY.md

# URL registry:
@rag-content/waterbot/url_registry.json

# Files to rewrite (batch — currently NO inline URLs):
@rag-content/waterbot/batch_programs.json
@rag-content/waterbot/batch_public_resources.json

# Files to update (individual — already have URLs):
@rag-content/waterbot/safer_overview.json
@rag-content/waterbot/safer_eligibility.json
@rag-content/waterbot/safer_funding_amounts.json
@rag-content/waterbot/cwsrf_guide.json
@rag-content/waterbot/dwsrf_guide.json
@rag-content/waterbot/dac_grants.json
@rag-content/waterbot/small_community_funding.json

**Established patterns from 02-01:**
- Inline URLs as markdown hyperlinks at natural citation points (2-5 per doc)
- "## Take Action" section with 3-5 numbered steps + linked URLs
- URL `type` field guides step wording (portal→"Apply at", form→"Submit via", etc.)
- Metadata preserved unchanged; content enhanced, not rewritten from scratch
- No bare URLs — all converted to `[Label](URL)` format

**Content Rewrite Specification:**
Same as 02-01 (inline URLs, "Take Action" sections, fact-check, preserve structure, JSON integrity). See 02-01-PLAN.md context for full spec.

**Special focus for this plan:** Programs/funding topics should emphasize:
- Eligibility criteria (who qualifies)
- Application process (where to apply, what forms)
- Funding amounts and timelines
- Links to specific program portals and application forms
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite 2 batch files — programs and public resources (18 docs)</name>
  <files>rag-content/waterbot/batch_programs.json, rag-content/waterbot/batch_public_resources.json</files>
  <action>
  Load url_registry.json and process each batch file following the 02-01 pattern:

  1. For each document, match `metadata.topic` to registry entry
  2. Enhance content with inline markdown URLs at natural citation points
  3. Add `## Take Action` section with 3-5 numbered, linked steps
  4. Fact-check eligibility thresholds, funding amounts, program deadlines

  **For programs topics** (e.g., "SAFER Program Overview", "CWSRF Loans"):
  - Inline links to program homepages, eligibility pages, application portals
  - "Take Action" should guide: check eligibility → gather docs → apply → contact program staff

  **For public resources topics** (e.g., "Water Quality Reports", "Environmental Justice"):
  - Inline links to databases, report tools, community resources
  - "Take Action" should guide: find your report → check data → engage with local board

  Write updated JSON back to same file paths.
  </action>
  <verify>
  Python verification:
  ```python
  import json
  for f in ['batch_programs.json', 'batch_public_resources.json']:
      data = json.load(open(f'rag-content/waterbot/{f}'))
      docs = data if isinstance(data, list) else data.get('documents', [])
      for d in docs:
          assert 'http' in d['content'], f"Missing URLs: {d['metadata']['topic']}"
          assert '## Take Action' in d['content'], f"Missing Take Action: {d['metadata']['topic']}"
      print(f'{f}: {len(docs)} docs OK')
  ```
  </verify>
  <done>All 18 docs across 2 batch files contain inline URLs and "Take Action" sections. JSON valid.</done>
</task>

<task type="auto">
  <name>Task 2: Update 7 individual funding files and verify all 9 files</name>
  <files>rag-content/waterbot/safer_overview.json, rag-content/waterbot/safer_eligibility.json, rag-content/waterbot/safer_funding_amounts.json, rag-content/waterbot/cwsrf_guide.json, rag-content/waterbot/dwsrf_guide.json, rag-content/waterbot/dac_grants.json, rag-content/waterbot/small_community_funding.json</files>
  <action>
  These 7 individual files already have URLs from Phase 1. For each:

  1. Compare content URLs against registry — add any missing registry URLs as inline links
  2. Convert bare URLs to markdown format: `[Label](URL)`
  3. Add `## Take Action` section if not present
  4. Fact-check funding amounts and eligibility criteria
     - SAFER: Check current funding cycle, eligible communities
     - CWSRF/DWSRF: Verify loan terms, interest rates if mentioned
     - DAC grants: Confirm disadvantaged community threshold ($MHI)
  5. Write updated JSON back

  Then verify ALL 9 files in this plan comprehensively:
  - Every doc has ≥2 inline markdown URLs
  - Every doc has "## Take Action" section
  - All URLs exist in registry
  - JSON valid
  - Total: 25 topics across 9 files
  </action>
  <verify>
  Comprehensive Python check:
  ```python
  import json, re
  files = [
      'batch_programs.json', 'batch_public_resources.json',
      'safer_overview.json', 'safer_eligibility.json', 'safer_funding_amounts.json',
      'cwsrf_guide.json', 'dwsrf_guide.json', 'dac_grants.json', 'small_community_funding.json'
  ]
  total = 0
  for f in files:
      data = json.load(open(f'rag-content/waterbot/{f}'))
      docs = data if isinstance(data, list) else data.get('documents', [])
      for d in docs:
          links = re.findall(r'\[([^\]]+)\]\(https?://[^)]+\)', d['content'])
          assert len(links) >= 2, f"Only {len(links)} links in {d['metadata']['topic']}"
          assert '## Take Action' in d['content'], f"Missing Take Action: {d['metadata']['topic']}"
          total += 1
  print(f'All {total} topics verified')
  ```
  </verify>
  <done>All 25 topics across 9 files have ≥2 inline markdown URLs and "Take Action" sections. Funding figures verified or flagged.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both batch files rewritten with inline URLs and "Take Action" sections
- [ ] All 7 individual files updated with consistent format
- [ ] Every doc has ≥2 inline markdown links
- [ ] Every doc has "## Take Action" with 3-5 linked steps
- [ ] Metadata unchanged in all files
- [ ] JSON valid for all 9 files
- [ ] No invented URLs — all from url_registry.json
</verification>

<success_criteria>

- All 25 topics enhanced with inline URLs and "Take Action" sections
- Funding amounts and eligibility criteria verified or flagged
- URL format consistent with Plan 02-01 pattern
- All verification checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-overhaul/02-02-SUMMARY.md`
</output>
