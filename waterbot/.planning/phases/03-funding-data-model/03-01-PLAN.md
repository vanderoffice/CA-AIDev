---
phase: 03-funding-data-model
plan: 01
type: execute
---

<objective>
Design the `funding-programs.json` schema and extract all program data from the existing 15 markdown knowledge base files and 7 RAG JSON files into a single structured data model.

Purpose: Create a machine-readable funding catalog that Phase 4's matching algorithm can consume — every program with typed eligibility criteria, so deterministic matching is possible without LLM interpretation.
Output: `public/funding-programs.json` with ~70-75 programs, each with eligibility predicates, amounts, links, and ragQuery fields.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (dependency graph):
@.planning/phases/01-shared-infrastructure/01-02-SUMMARY.md
@.planning/phases/02-permit-finder/02-03-SUMMARY.md

# Source material — knowledge base (15 markdown files):
@knowledge/04-funding/federal/epa-funding.md
@knowledge/04-funding/federal/fema-mitigation.md
@knowledge/04-funding/federal/other-federal-programs.md
@knowledge/04-funding/federal/usda-rural-water.md
@knowledge/04-funding/grants/emergency-drought-funding.md
@knowledge/04-funding/grants/irwm-funding.md
@knowledge/04-funding/grants/prop1-overview.md
@knowledge/04-funding/grants/swrcb-grants.md
@knowledge/04-funding/private/alternative-financing.md
@knowledge/04-funding/private/environmental-foundations.md
@knowledge/04-funding/private/technical-assistance-providers.md
@knowledge/04-funding/private/water-foundations.md
@knowledge/04-funding/srf/cwsrf-overview.md
@knowledge/04-funding/srf/dwsrf-overview.md
@knowledge/04-funding/srf/srf-small-communities.md

# Source material — RAG JSON files (7 files):
@rag-content/waterbot/cwsrf_guide.json
@rag-content/waterbot/dac_grants.json
@rag-content/waterbot/dwsrf_guide.json
@rag-content/waterbot/safer_eligibility.json
@rag-content/waterbot/safer_funding_amounts.json
@rag-content/waterbot/safer_overview.json
@rag-content/waterbot/small_community_funding.json

# Reference pattern — permit decision tree structure:
@public/permit-decision-tree.json

# Existing components that will consume this data (Phase 4):
@src/components/ResultCard.jsx

**Tech stack available:** React 18, Vite, Tailwind (but this plan is pure data — no UI)
**Established patterns:**
- permit-decision-tree.json: version metadata, flat node map with typed entries, result nodes with ragQuery
- ResultCard expects: name, description, details grid (agency, fees, timeline, etc.), requirements[], nextSteps[]
- RAG enrichment uses ragQuery string to fire against n8n webhook

**Constraining decisions:**
- [01-02]: ResultCard uses expandable sections with details grid — funding data model should produce fields that map naturally to this display
- [02-03]: RAG enrichment is non-blocking async — each program needs a ragQuery for knowledge base cross-reference
</context>

<tasks>

<task type="auto">
  <name>Task 1: Design funding-programs.json schema</name>
  <files>public/funding-programs.json</files>
  <action>
Create `public/funding-programs.json` with the following top-level structure:

```json
{
  "version": "1.0.0",
  "lastUpdated": "2026-02-14",
  "metadata": {
    "title": "California Water Infrastructure Funding Programs",
    "description": "Machine-readable catalog of federal, state, and private funding programs for water infrastructure projects",
    "disclaimer": "Eligibility information is for guidance only. Always verify current requirements directly with the administering agency before applying.",
    "totalPrograms": <count>
  },
  "programs": [ ... ]
}
```

Each program object in the `programs` array MUST have these fields:

```json
{
  "id": "dwsrf",
  "name": "Drinking Water State Revolving Fund",
  "abbreviation": "DWSRF",
  "category": "state-srf" | "state-grant" | "federal" | "private" | "technical-assistance",
  "subcategory": "loan" | "grant" | "loan-with-forgiveness" | "bond" | "technical-assistance" | "mixed",
  "administeredBy": "State Water Resources Control Board",
  "description": "Brief 1-2 sentence summary",
  "fundingType": "loan" | "grant" | "loan-and-grant" | "technical-assistance" | "mixed",
  "fundingRange": {
    "min": null | number,
    "max": null | number,
    "unit": "USD",
    "notes": "Up to $X per project" | null
  },
  "interestRate": {
    "min": null | number,
    "max": null | number,
    "notes": "Below market rate" | null
  },
  "repaymentTermYears": null | number,
  "eligibility": {
    "entityTypes": ["public-agency", "nonprofit", "tribe", "mutual-water-company", "private-utility"],
    "systemSizeMax": null | number,
    "populationMax": null | number,
    "dacRequired": false | true | "preferred",
    "sdacRequired": false | true | "preferred",
    "projectTypes": ["treatment", "distribution", "storage", "consolidation", "emergency", "planning", "recycling", "stormwater", "operations"],
    "complianceIssueRequired": false | true,
    "environmentalReviewRequired": false | true,
    "matchRequired": false | true,
    "matchPercentage": null | number,
    "additionalCriteria": ["string describing any other requirements"] | []
  },
  "principalForgiveness": {
    "available": true | false,
    "conditions": "For DAC/SDAC communities" | null
  },
  "applicationUrl": "https://..." | null,
  "programUrl": "https://..." | null,
  "ragQuery": "Tell me about the DWSRF program eligibility and application process",
  "relatedPrograms": ["cwsrf", "safer"] | [],
  "tags": ["drinking-water", "small-community", "dac"]
}
```

**Schema design decisions (and WHY):**
- Flat array (not tree) because funding programs don't branch — matching is filter-based, not path-based
- `eligibility` object has typed predicates so Phase 4 can do deterministic matching without string parsing
- `dacRequired` uses three-value (false/true/"preferred") because some programs prefer but don't require DAC status
- `relatedPrograms` uses ID cross-references for the Phase 5 cross-linking feature
- `ragQuery` follows the permit-decision-tree pattern so RAG enrichment works identically
- `fundingRange` uses min/max with notes because many programs don't publish fixed amounts
- `tags` array enables future search/filter features

Start with the schema structure and 3-5 placeholder programs to validate the shape. Do NOT populate all programs yet — that's Task 2.
  </action>
  <verify>node -e "const d = require('./public/funding-programs.json'); console.log('Programs:', d.programs.length); console.log('Version:', d.version); console.log('Fields:', Object.keys(d.programs[0]).join(', '))"</verify>
  <done>funding-programs.json exists with valid JSON, correct top-level structure, and 3-5 programs that validate the schema shape. Every program has all required fields.</done>
</task>

<task type="auto">
  <name>Task 2: Extract all programs from knowledge base into schema</name>
  <files>public/funding-programs.json</files>
  <action>
Read ALL 15 markdown files in `knowledge/04-funding/` and ALL 7 RAG JSON files in `rag-content/waterbot/` listed in the context section above.

Extract every distinct funding program into a program object following the schema from Task 1. Group by source:

**Federal programs (~15-20):** EPA (WIFIA, Environmental Justice Grants, Clean Water Act 319, Brownfields), FEMA (HMGP, BRIC, FMA), USDA (Water & Waste Disposal, SEARCH, Circuit Rider), Bureau of Reclamation (WaterSMART), Army Corps, HUD CDBG, EDA, Title XVI

**State SRF (~5-8):** DWSRF, CWSRF, SAFER, Small Community Drinking Water, Principal Forgiveness variants

**State grants (~10-15):** Prop 1 chapters (Groundwater, Watershed, Recycling, etc.), IRWM, Storm Water Grant, Water Recycling (WRFP), Emergency/Drought, Prop 68, Prop 4

**Private/philanthropic (~10-15):** Packard Foundation, Water Foundation, Moore Foundation, Pisces Foundation, California Community Foundation, Resources Legacy Fund, Environmental Impact Bonds, Green Bonds

**Technical assistance (~5-8):** RCAC, Community Water Center, CRWA, Self-Help Enterprises, various TA programs

**Cross-referencing rules:**
- When a program appears in BOTH markdown and RAG JSON, merge data (RAG JSON often has more current details)
- Use the most specific eligibility criteria found across all sources
- If sources conflict on amounts/rates, use the more conservative (lower) figure and note the discrepancy in `fundingRange.notes` or `interestRate.notes`
- Set `ragQuery` to a natural question that would retrieve the most useful RAG context about that specific program
- Set `relatedPrograms` by linking programs that are commonly stacked or used together (e.g., DWSRF + SAFER, Prop 1 + IRWM)
- `applicationUrl` should point to FAAST portal (https://faast.waterboards.ca.gov/) for state programs where applicable

**Do NOT fabricate data.** If a field isn't available in the source material, use `null` for numbers and `[]` for arrays. Plan 03-02 will fill gaps via live source verification.

Update `metadata.totalPrograms` to match actual count when done.
  </action>
  <verify>node -e "const d = require('./public/funding-programs.json'); const cats = {}; d.programs.forEach(p => { cats[p.category] = (cats[p.category]||0)+1 }); console.log('Total:', d.programs.length); console.log('By category:', JSON.stringify(cats, null, 2)); const missing = d.programs.filter(p => !p.ragQuery); console.log('Missing ragQuery:', missing.length); const noId = d.programs.filter(p => !p.id); console.log('Missing id:', noId.length); const dupes = d.programs.map(p=>p.id).filter((v,i,a)=>a.indexOf(v)!==i); console.log('Duplicate ids:', dupes)"</verify>
  <done>funding-programs.json contains 50+ programs across all 5 categories. Every program has a unique id, valid category, eligibility object with typed predicates, and a ragQuery string. No duplicate IDs. metadata.totalPrograms matches actual count.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `node -e "JSON.parse(require('fs').readFileSync('public/funding-programs.json'))"` — valid JSON
- [ ] Every program has all required schema fields (no undefined or missing keys)
- [ ] No duplicate program IDs
- [ ] All 5 categories represented (state-srf, state-grant, federal, private, technical-assistance)
- [ ] ragQuery present on every program
- [ ] metadata.totalPrograms matches d.programs.length
- [ ] relatedPrograms only reference IDs that exist in the programs array
</verification>

<success_criteria>

- funding-programs.json exists in public/ with valid schema
- 50+ programs extracted from knowledge base
- All 5 categories represented
- Every program has typed eligibility predicates
- Every program has ragQuery for RAG enrichment
- relatedPrograms cross-references are valid
- No fabricated data — nulls where source material doesn't specify
</success_criteria>

<output>
After completion, create `.planning/phases/03-funding-data-model/03-01-SUMMARY.md`
</output>
