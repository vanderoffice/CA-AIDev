---
phase: 01-shared-infrastructure
plan: 01
type: execute
---

<objective>
Restore the broken build (missing component/hook files) and create the reusable WizardStepper shell component that both Permit Finder and Funding Navigator will use.

Purpose: Get the app building again, then establish the shared wizard pattern that Phase 2 and Phase 4 depend on.
Output: Working build with Icons, BotHeader, useBotPersistence restored + WizardStepper component ready for consumption.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/pages/WaterBot.jsx
@src/index.css
@permit-decision-tree.json

**Current state:** The app does NOT build. `WaterBot.jsx` imports `Icons`, `BotHeader`, and `useBotPersistence` — none of which exist on disk. These were from the orphaned v1.0 repo and were never consolidated into this canonical repo.

**Tech stack:** React 18.2, Vite 5, Tailwind CSS 3.4, react-markdown. No component library — hand-crafted SVG icons, vanilla React state.

**Design language:** Dark theme (#050505 bg, #e5e5e5 text), sky-500 accent (`#0ea5e9`), `glow-box`/`glow-text` utility classes, Inter font, neutral-800 borders.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restore missing Icons, BotHeader, and useBotPersistence</name>
  <files>src/components/Icons.jsx, src/components/BotHeader.jsx, src/hooks/useBotPersistence.js</files>
  <action>
Create three files that WaterBot.jsx already imports:

**Icons.jsx** — Export named SVG icon components matching the import signature: `{ Droplets, Send, User, Loader, MessageSquare, ArrowRight }`. Each component accepts `size` (default 24) and `className` props. Use simple inline SVG paths (lucide-style). Keep each icon under 10 lines. Do NOT add a dependency on lucide-react — the original used hand-crafted SVGs.

**BotHeader.jsx** — Default export. Props: `{ title, subtitle, mode, messages, onBack, onReset }`. Renders:
- Left side: back arrow button (calls `onBack`) + title/subtitle
- Right side: online indicator dot + optional reset button (calls `onReset`, only shown when `messages.length > 0`)
- Bottom border matching `border-neutral-800` pattern
- Match the landing page header style from WaterBot.jsx lines 143-151.

**useBotPersistence.js** — Custom hook. Takes `botName` string. Returns `{ sessionId, messages, mode, setMessages, setMode, reset }`.
- `sessionId`: Generate once with `crypto.randomUUID()`, persist in sessionStorage under `${botName}-sessionId`
- `messages`: Array persisted in sessionStorage under `${botName}-messages`
- `mode`: String persisted in sessionStorage under `${botName}-mode`, defaults to `'choice'`
- `setMessages`: Standard setter (also writes to sessionStorage)
- `setMode`: Standard setter (also writes to sessionStorage)
- `reset`: Clears all sessionStorage keys for this bot, regenerates sessionId, resets mode to `'choice'` and messages to `[]`
- Use `useState` with lazy initializers reading from sessionStorage. Use `useEffect` to sync state changes back to sessionStorage.

Create `src/hooks/` directory (doesn't exist yet). Remove the `.gitkeep` from `src/components/` after adding real files.
  </action>
  <verify>npm run build succeeds with zero errors. The existing WaterBot.jsx renders without changes.</verify>
  <done>Build passes. All imports in WaterBot.jsx resolve. No runtime errors in `npm run dev`.</done>
</task>

<task type="auto">
  <name>Task 2: Create WizardStepper shell component</name>
  <files>src/components/WizardStepper.jsx</files>
  <action>
Create a reusable wizard stepper component that both Permit Finder (Phase 2) and Funding Navigator (Phase 4) will consume.

**Props:**
- `steps` — Array of step objects: `{ id, title, content }` where `content` is a React node
- `currentStep` — Current step index (0-based), controlled by parent
- `onNext` — Called when user clicks "Next" or selects an option
- `onBack` — Called when user clicks "Back"
- `onRestart` — Called when user clicks "Start Over" (optional)
- `title` — Wizard title (e.g., "Permit Finder")
- `subtitle` — Optional subtitle
- `children` — Alternative to steps array; renders children as the current step content (for dynamic content like the decision tree where steps aren't known upfront)

**Renders:**
1. **Progress bar** — Horizontal bar showing progress. If `steps` provided, show step X of Y. If using `children` (dynamic mode), show a simple back arrow + step count.
2. **Step content area** — Renders current step's `content` or `children`. Scrollable if content overflows. Apply `animate-in` class for transitions.
3. **Navigation footer** — Back button (disabled on first step), forward/action button. Back button uses ArrowLeft icon. Style buttons with existing `glow-box` and sky-500 accent patterns.

**Design requirements:**
- Match existing dark theme: `bg-neutral-900`, `border-neutral-800`, sky-500 accents
- Progress indicator: thin bar (`h-1`) at top, sky-500 fill, neutral-800 track
- Smooth transitions between steps (use existing `animate-in` / `fadeIn` CSS)
- The component is a SHELL — it manages layout, progress, and navigation UI only. Content rendering is the parent's job via `children` or `steps[currentStep].content`.

**Important:** The Permit Finder uses a decision tree (dynamic branching, unknown total steps). The Funding Navigator uses a fixed questionnaire (known steps). WizardStepper must support BOTH patterns:
- **Fixed mode:** `steps` array provided, progress shows "Step X of Y"
- **Dynamic mode:** No `steps`, parent passes `children` and manages `currentStep` as a counter. Progress shows step count only (no total).

Do NOT add react-router or any routing library — mode switching is handled by state in WaterBot.jsx.
  </action>
  <verify>Import WizardStepper in a quick test within App.jsx (temporary) with 3 dummy steps. Verify it renders, back/forward work, progress updates. Remove test code after verification. `npm run build` still passes.</verify>
  <done>WizardStepper component exists, exports default, accepts both fixed and dynamic step patterns, renders with correct dark theme styling, build passes.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds with zero errors
- [ ] `npm run dev` loads the landing page without console errors
- [ ] Mode selection (chat) works end-to-end
- [ ] WizardStepper component exists and is importable
- [ ] No new dependencies added to package.json (pure React + existing Tailwind)
</verification>

<success_criteria>

- Build restored — all imports resolve
- useBotPersistence hook persists sessionId, messages, and mode to sessionStorage
- WizardStepper supports both fixed steps (array) and dynamic children patterns
- All styling matches existing dark theme
- Zero new npm dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/01-shared-infrastructure/01-01-SUMMARY.md`
</output>
