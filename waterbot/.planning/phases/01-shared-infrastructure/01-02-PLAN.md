---
phase: 01-shared-infrastructure
plan: 02
type: execute
---

<objective>
Create the ResultCard display component, "Ask WaterBot" chat handoff, and activate the disabled mode buttons on the landing page so users can navigate to Permit Finder and Funding Navigator placeholders.

Purpose: Complete the shared component library and wire up the full navigation flow — users can select any mode from the landing page.
Output: ResultCard component, AskWaterBot handoff utility, fully navigable landing page with all three modes active.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-shared-infrastructure/01-01-SUMMARY.md
@src/pages/WaterBot.jsx
@src/components/WizardStepper.jsx
@src/components/Icons.jsx
@src/index.css
@permit-decision-tree.json

**From 01-01:** Build is restored, WizardStepper component available.

**Decision tree result node structure** (for ResultCard design):
```json
{
  "type": "result",
  "title": "string",
  "permits": [{ "name", "code", "description", "agency", "link", "estimatedTime", "fees" }],
  "requirements": ["string"],
  "nextSteps": ["string"],
  "ragQuery": "string"
}
```

**Design language:** Dark theme (#050505 bg), sky-500 accent, glow-box/glow-text utilities, neutral-800 borders, Inter font.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ResultCard component and AskWaterBot handoff</name>
  <files>src/components/ResultCard.jsx, src/components/AskWaterBot.jsx</files>
  <action>
**ResultCard.jsx** — Reusable card for displaying a permit or funding program result.

Props:
- `title` — Card heading (permit name or program name)
- `code` — Optional code/identifier (e.g., "NPDES", "CWSRF")
- `description` — Brief description text
- `agency` — Issuing/managing agency name
- `link` — External URL to official page
- `details` — Object with optional keys: `{ estimatedTime, fees, fundingRange, deadline }`
- `requirements` — Array of requirement strings (expandable section)
- `nextSteps` — Array of next-step strings (expandable section)
- `ragQuery` — String used for "Ask WaterBot" handoff (if present, show handoff button)
- `onAskWaterBot` — Callback when "Ask WaterBot" is clicked, receives `ragQuery`

Renders:
1. **Header row:** Title + code badge (if present). Code badge: small pill with `bg-sky-500/20 text-sky-400` styling.
2. **Description:** 2-3 line description text in `text-neutral-400`.
3. **Details grid:** 2-column grid showing available detail fields (time, fees, etc.) with label + value. Only render fields that have values.
4. **Agency + link:** Agency name with external link icon. Opens in new tab.
5. **Expandable sections:** "Requirements" and "Next Steps" — collapsed by default, toggle open with chevron. Render as ordered lists. Use local `useState` for toggle.
6. **AskWaterBot button:** If `ragQuery` provided, show "Ask WaterBot about this" button at bottom. Style: `border border-sky-500/50 text-sky-400 hover:bg-sky-500/10` with a chat icon.

Styling: `bg-neutral-900 border border-neutral-800 rounded-lg p-5 glow-box`. Match existing card patterns.

**AskWaterBot.jsx** — Small standalone button component (also usable independently from ResultCard).

Props:
- `query` — The pre-filled question text
- `onClick` — Callback receiving the query string
- `variant` — `'button'` (default) or `'inline'` (for embedding in text)

Renders a styled button with MessageSquare icon + "Ask WaterBot about this" text. The `inline` variant is smaller and rendered as a text link.

This component does NOT handle navigation — it just fires the callback. The parent (WaterBot.jsx) handles switching to chat mode and pre-filling the message.
  </action>
  <verify>Import ResultCard in a temporary test, render with sample permit data from the decision tree. Verify card displays correctly, expandable sections toggle, AskWaterBot button is visible. `npm run build` passes.</verify>
  <done>ResultCard renders permit/funding data with expandable sections. AskWaterBot button fires callback. Both components build without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Activate landing page mode buttons and add mode routing</name>
  <files>src/pages/WaterBot.jsx, src/components/Icons.jsx</files>
  <action>
Modify WaterBot.jsx to make ALL three mode buttons active and route to the correct views:

1. **Remove `disabled: true`** from the `permits` and `funding` entries in the `MODES` array.

2. **Add icons:** Update the `permits` mode to use a distinct icon (add `Search` or `ClipboardList` to Icons.jsx). Update `funding` to use `DollarSign` or `Banknote` icon. Add these to Icons.jsx as simple SVG components.

3. **Add mode routing:** After the existing `if (mode === 'choice')` and chat interface blocks in the render, add:
   - `if (mode === 'permits')` → Render a placeholder Permit Finder page using WizardStepper in dynamic mode. Show BotHeader with title "Permit Finder" and back button to return to choice. Inside WizardStepper, render a single placeholder step: "Permit Finder is being built — coming soon in Phase 2." with a descriptive message about what it will do.
   - `if (mode === 'funding')` → Same pattern for Funding Navigator placeholder. Title "Funding Navigator", placeholder message about Phase 4.

4. **Wire up "Ask WaterBot" handoff:** Add a `handleAskWaterBot` function that:
   - Switches mode to `'chat'`
   - Pre-fills the first message by calling `sendMessage(query)` after a brief delay (use `setTimeout(..., 100)` to let the mode switch render first)
   - This function will be passed as `onAskWaterBot` to ResultCard in Phase 2+

5. **Update MODES descriptions** — now that they're clickable, make descriptions more action-oriented:
   - Permits: "Find which permits your project needs" (instead of "Find out if you need a permit")
   - Funding: "Discover funding programs you may qualify for" (instead of "Check eligibility")

Do NOT add react-router. Mode switching stays as React state via `setMode()`, same pattern as the existing chat flow.
  </action>
  <verify>npm run dev — click each mode button on landing page. "Ask WaterBot" opens chat. "Permit Finder" shows placeholder with WizardStepper shell and back button. "Funding Navigator" shows placeholder with back button. Back buttons return to choice screen. `npm run build` succeeds.</verify>
  <done>All three mode buttons clickable. Each mode renders its view. Back navigation works from all modes to choice screen. handleAskWaterBot function exists and pre-fills chat. Build passes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full shared infrastructure: restored build, WizardStepper, ResultCard, AskWaterBot handoff, and all three mode buttons active on landing page</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173 (or whatever Vite port)
    3. Verify: Landing page shows 3 mode cards — ALL clickable (none grayed out)
    4. Click "Ask WaterBot" → chat opens, type a question, get response
    5. Click back arrow → returns to landing page
    6. Click "Permit Finder" → shows placeholder page with WizardStepper shell + back button
    7. Click back → returns to landing page
    8. Click "Funding Navigator" → shows placeholder page with WizardStepper shell + back button
    9. Click back → returns to landing page
    10. Verify: Dark theme consistent across all views, no layout jumps, no console errors
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds with zero errors
- [ ] All three mode buttons are clickable on landing page
- [ ] Each mode routes to its correct view (chat, permit placeholder, funding placeholder)
- [ ] Back navigation works from every mode
- [ ] handleAskWaterBot function is wired up and pre-fills chat
- [ ] ResultCard renders with expandable sections
- [ ] No new npm dependencies added
- [ ] Dark theme consistent across all new components
</verification>

<success_criteria>

- All tasks completed and verified
- All verification checks pass
- Shared component library complete: WizardStepper, ResultCard, AskWaterBot, Icons, BotHeader
- Landing page fully navigable with all 3 modes
- handleAskWaterBot handoff works end-to-end
- Phase 1 complete — ready for Phase 2 (Permit Finder)
</success_criteria>

<output>
After completion, create `.planning/phases/01-shared-infrastructure/01-02-SUMMARY.md`
</output>
