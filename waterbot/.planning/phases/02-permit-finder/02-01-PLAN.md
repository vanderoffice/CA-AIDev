---
phase: 02-permit-finder
plan: 01
type: execute
---

<objective>
Create the PermitFinder component with decision tree traversal engine, question node rendering, and full navigation history — the architectural core of the Permit Finder tool.

Purpose: Enable users to navigate the 83-node permit decision tree through guided questions, with back/restart support, replacing the placeholder permits page.
Output: Working PermitFinder component wired into WaterBot.jsx, rendering question nodes with selectable options and full navigation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (Phase 1 — direct dependency):
@.planning/phases/01-shared-infrastructure/01-01-SUMMARY.md
@.planning/phases/01-shared-infrastructure/01-02-SUMMARY.md

# Key source files:
@src/pages/WaterBot.jsx
@src/components/WizardStepper.jsx
@src/components/BotHeader.jsx
@src/components/Icons.jsx
@permit-decision-tree.json

**Tech stack available:** React 18.2 + Vite + Tailwind CSS
**Established patterns:**
- Controlled wizard: parent manages step state, WizardStepper manages layout/chrome
- Icon components: size + className props, inline SVG paths
- Mode routing: explicit if-blocks per mode in WaterBot.jsx render, setMode('choice') for back nav
- Session persistence: botName-prefixed keys in sessionStorage via useBotPersistence

**Constraining decisions:**
- Phase 01-01: WizardStepper uses controlled component pattern — parent owns currentStep
- Phase 01-02: Mode routing stays as React state (no react-router)
- Phase 01-02: handleAskWaterBot uses setTimeout(100ms) delay for mode switch

**Decision tree location:** `permit-decision-tree.json` (project root, 83 nodes)
- Question nodes: { id, type: "question", title, helpText, options: [{ id, label, description, icon?, next }] }
- Result nodes: { id, type: "result", title, permits[], requirements[], nextSteps[], ragQuery }
- Entry point: nodes.start
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PermitFinder component with traversal engine and question rendering</name>
  <files>src/components/PermitFinder.jsx</files>
  <action>
Create PermitFinder.jsx as a self-contained component:

**Props:** { onAskWaterBot, onBack }
- onAskWaterBot: callback from WaterBot.jsx for chat handoff
- onBack: callback to return to landing page (mode='choice')

**Data:** Import permit-decision-tree.json from project root. Access nodes via treeData.nodes.

**State:**
- currentNodeId (string, init 'start') — which node we're displaying
- history (array of string IDs) — stack of previously visited node IDs for back navigation

**Navigation functions:**
- selectOption(nextNodeId): push currentNodeId onto history, set currentNodeId to nextNodeId
- goBack(): if history has items, pop last ID and set as currentNodeId; if history is empty, call onBack() to return to landing
- restart(): set currentNodeId to 'start', clear history to []

**Rendering:**
- Get currentNode from treeData.nodes[currentNodeId]
- Wrap everything in BotHeader (title="Permit Finder", onBack={goBack})
- Use WizardStepper in dynamic mode (no steps prop):
  - currentStep={history.length}
  - onBack={goBack}
  - onRestart={history.length > 0 ? restart : undefined}
  - title={currentNode.title}

**Question node rendering (type === 'question'):**
- Show helpText as a styled paragraph below the WizardStepper title area
- Map options to styled buttons:
  - Each button shows: option.label (bold/prominent) and option.description (smaller text below)
  - If option.icon exists, show it as text/emoji prefix
  - onClick calls selectOption(option.next)
  - Style: dark themed cards (bg-slate-800/bg-zinc-800 with hover:bg-slate-700), rounded, full-width, text-left, padding, subtle border
  - Stack vertically with gap

**Result node rendering (type === 'result'):**
- For now, render a minimal placeholder: node.title as heading + "Permit results will display here" text
- 02-02 will implement full ResultCard rendering

Do NOT use position: relative on any section elements. Follow existing Tailwind class patterns from WaterBot.jsx.
  </action>
  <verify>npm run build succeeds with zero errors. Component file exists and exports default.</verify>
  <done>PermitFinder.jsx created with traversal engine, question rendering with styled option buttons, navigation history (back/restart), and result placeholder.</done>
</task>

<task type="auto">
  <name>Task 2: Wire PermitFinder into WaterBot.jsx replacing placeholder</name>
  <files>src/pages/WaterBot.jsx</files>
  <action>
In WaterBot.jsx:

1. Import PermitFinder: `import PermitFinder from '../components/PermitFinder'`

2. Replace the entire `mode === 'permits'` block (which currently renders BotHeader + WizardStepper with "Coming in Phase 2" placeholder) with:
   ```
   <PermitFinder
     onAskWaterBot={handleAskWaterBot}
     onBack={() => setMode('choice')}
   />
   ```

3. Remove the BotHeader and WizardStepper wrapper that currently wraps the permits placeholder — PermitFinder manages its own BotHeader and WizardStepper internally.

4. Keep the existing funding placeholder page unchanged.

Do NOT modify any chat functionality, sendMessage, or other modes.
  </action>
  <verify>npm run build succeeds. Dev server: clicking "Find Permits" on landing page shows the decision tree first question ("What type of water-related project are you working on?" or similar). Navigate 3+ levels deep. Back button returns to previous question. Back from first question returns to landing page.</verify>
  <done>Permit Finder accessible from landing page, first question renders with all options, forward/back navigation works through at least 3 levels, back from root returns to landing, "Start Over" resets to first question.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors or warnings
- [ ] Clicking "Find Permits" shows first decision tree question
- [ ] Option buttons display label + description for each choice
- [ ] Selecting an option navigates to next question
- [ ] Back button returns to previous question at every level
- [ ] Back from first question returns to landing page
- [ ] "Start Over" resets to first question from any depth
- [ ] Result nodes show placeholder text (not blank/error)
- [ ] Chat mode still works (no regression)
- [ ] Funding placeholder still works (no regression)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or console warnings
- Decision tree traversal works with real 83-node data
- Navigation history (back/restart) works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-permit-finder/02-01-SUMMARY.md`
</output>
