---
phase: 02-permit-finder
plan: 02
type: execute
---

<objective>
Implement full result node rendering using ResultCard components — displaying permit details (name, code, agency, fees, timeline, links), expandable requirements/nextSteps checklists, and "Ask WaterBot" handoff.

Purpose: Make the Permit Finder produce useful output — when users reach a result node, they see complete permit information they can act on.
Output: Result screens with full permit details via ResultCard, working handoff to chat, and polished end-to-end flow.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summary:
@.planning/phases/02-permit-finder/02-01-SUMMARY.md
@.planning/phases/01-shared-infrastructure/01-02-SUMMARY.md

# Key source files:
@src/components/PermitFinder.jsx
@src/components/ResultCard.jsx
@src/components/AskWaterBot.jsx
@src/components/Icons.jsx
@permit-decision-tree.json

**Tech stack available:** React 18.2 + Vite + Tailwind CSS
**Established patterns:**
- ResultCard props: { title, code, description, agency, link, details: { estimatedTime?, fees? }, requirements, nextSteps, ragQuery, onAskWaterBot }
- AskWaterBot props: { query, onClick, variant? }
- Expandable card sections with ChevronDown rotation
- Chat handoff: parent passes callback, component fires with query string

**Decision tree result node shape:**
```json
{
  "type": "result",
  "title": "Construction General Permit - Risk Level 1",
  "permits": [{
    "name": "...", "code": "...", "description": "...",
    "agency": "...", "link": "...",
    "estimatedTime": "...", "fees": "..."
  }],
  "requirements": ["..."],
  "nextSteps": ["..."],
  "ragQuery": "..."
}
```
Note: requirements and nextSteps are at the NODE level (shared across all permits in the result), not per-permit.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement result node rendering with ResultCards</name>
  <files>src/components/PermitFinder.jsx</files>
  <action>
Replace the result placeholder in PermitFinder.jsx with full result rendering:

**When currentNode.type === 'result':**

1. **Result header:** Show currentNode.title as a heading (text-xl font-semibold text-white). Below it, add context text like "Based on your answers, you may need the following permit(s):" in text-slate-400.

2. **Permit cards:** Map currentNode.permits to ResultCard components. For each permit, pass:
   - title={permit.name}
   - code={permit.code}
   - description={permit.description}
   - agency={permit.agency}
   - link={permit.link}
   - details={{ estimatedTime: permit.estimatedTime, fees: permit.fees }}
   - requirements={currentNode.requirements}
   - nextSteps={currentNode.nextSteps}
   - ragQuery={currentNode.ragQuery}
   - onAskWaterBot={onAskWaterBot}

   Note: requirements, nextSteps, and ragQuery come from the NODE, not individual permits.

   If a result has multiple permits, each ResultCard gets the same requirements/nextSteps/ragQuery since they're node-level.

3. **Restart button:** Below the ResultCards, add a "Start New Search" button:
   - onClick={restart}
   - Style: full-width, bg-slate-700 hover:bg-slate-600, rounded, py-3, text-white, with an ArrowRight or similar icon
   - Visually distinct from ResultCards (it's a navigation action, not a result)

4. **WizardStepper adjustment:** When showing results, the WizardStepper should either hide the step counter or show "Results" instead of "Step X". Pass a flag or adjust the subtitle. If WizardStepper doesn't support this natively, adjust the title/subtitle props to indicate completion (e.g., title="Your Permits", subtitle="").

5. **Handle edge cases:**
   - If currentNode.permits is empty (shouldn't happen but defensive): show "No permits found for this path" message
   - If permit.estimatedTime or permit.fees is undefined: ResultCard already filters missing detail fields — no extra work needed
  </action>
  <verify>npm run build succeeds. Navigate to any result node — ResultCards display with permit name, code badge, description, agency, link, details grid. Expandable Requirements and Next Steps sections work. "Ask WaterBot about this" button appears.</verify>
  <done>Result nodes render full permit details via ResultCard, expandable sections work, "Start New Search" button resets flow, no console errors.</done>
</task>

<task type="auto">
  <name>Task 2: Verify end-to-end flow and chat handoff</name>
  <files>src/components/PermitFinder.jsx</files>
  <action>
Test and fix the complete Permit Finder flow:

1. **Multi-path verification:** Navigate through at least 3 different branches of the decision tree to reach different result types. Verify each path displays correct permits.

2. **Chat handoff test:** On any result screen, click "Ask WaterBot about this" button. Verify:
   - Mode switches to chat
   - The ragQuery is sent as a message
   - Chat responds (or at least the message appears in the chat)
   - If the webhook is live, response should arrive

3. **Navigation edge cases:**
   - From result screen, press Back → should return to last question (not landing)
   - From result screen, press "Start New Search" → should return to first question
   - Navigate to result → back → select different option → reach different result
   - Rapidly click options (no double-navigation bugs)

4. **Visual consistency:** Ensure result screens match WaterBot dark theme:
   - ResultCard backgrounds should be visible against the page background
   - Text should be readable (sufficient contrast)
   - No layout overflow or horizontal scrolling on mobile-width viewports

Fix any issues found during verification. Minor styling adjustments are expected.
  </action>
  <verify>npm run build succeeds. Full flow works: landing → permits → 3+ questions → result → "Ask WaterBot" → chat with prefilled query. Back navigation works from result screen. Multiple paths produce different results.</verify>
  <done>End-to-end Permit Finder flow works across multiple branches, chat handoff fires correctly, back navigation works from results, no console errors, visually consistent with WaterBot theme.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Result nodes display permit details (name, code, description, agency, link)
- [ ] Details grid shows estimatedTime and fees when available
- [ ] Expandable Requirements section works (click to expand/collapse)
- [ ] Expandable Next Steps section works
- [ ] "Ask WaterBot about this" button fires handoff to chat mode
- [ ] Chat receives the ragQuery as a prefilled message
- [ ] "Start New Search" button resets to first question
- [ ] Back from result returns to last question, not landing
- [ ] Multiple result paths display different permits correctly
- [ ] No layout issues on narrow viewports
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or console warnings
- Permit Finder produces actionable results users can act on
- Chat handoff works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/02-permit-finder/02-02-SUMMARY.md`
</output>
