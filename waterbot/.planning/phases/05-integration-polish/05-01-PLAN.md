---
phase: 05-integration-polish
plan: 01
type: execute
---

<objective>
Wire cross-tool navigation between Permit Finder, Funding Navigator, and Chat so each tool's results link naturally to the others.

Purpose: Users who discover required permits should easily explore funding; users browsing funding should be prompted to check permits. Related funding programs (already cross-referenced in data) should surface on result cards.
Output: Cross-tool CTAs on both result screens, related programs section on funding cards, mode-switching wired through WaterBot.jsx.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Auto-selected based on dependency graph:
@.planning/phases/01-shared-infrastructure/01-02-SUMMARY.md
@.planning/phases/02-permit-finder/02-02-SUMMARY.md
@.planning/phases/04-funding-navigator/04-03-SUMMARY.md

# Key files:
@src/pages/WaterBot.jsx
@src/components/PermitFinder.jsx
@src/components/FundingNavigator.jsx
@src/components/ResultCard.jsx
@src/components/Icons.jsx

**Tech stack available:** React 18 + Vite + Tailwind CSS, no router (mode routing via state)
**Established patterns:** mode-routing-via-state, chat-handoff-with-delay (100ms setTimeout), self-contained tool components owning their own BotHeader/WizardStepper, tiered-results-rendering, expandable-card-sections

**Constraining decisions:**
- [01-02]: Mode routing stays as React state (no react-router) — cross-tool links must use `setMode()` callback
- [01-02]: handleAskWaterBot uses setTimeout(100ms) delay — mode switching should follow same pattern
- [01-02]: ResultCard uses local useState for expandable toggles — keep component self-contained
- [03-01]: relatedPrograms uses ID cross-references (57/58 programs have them, 0 broken refs)
- [04-03]: RAG pattern reused inline per tool — no shared abstraction
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cross-tool CTAs on result screens</name>
  <files>src/pages/WaterBot.jsx, src/components/PermitFinder.jsx, src/components/FundingNavigator.jsx, src/components/Icons.jsx</files>
  <action>
    1. In WaterBot.jsx: Pass `onSwitchMode={(mode) => setMode(mode)}` prop to both PermitFinder and FundingNavigator (in addition to existing props).

    2. In PermitFinder.jsx: Accept `onSwitchMode` prop. After the "Start New Search" button in the result view, add a cross-tool CTA section:
       - A styled card with DollarSign icon, heading "Need Help Funding This Project?", brief text "Discover grant and loan programs you may qualify for", and a button "Explore Funding →" that calls `onSwitchMode('funding')`.
       - Use existing card styling pattern: `bg-cyan-500/10 border border-cyan-500/30 rounded-lg p-5`.

    3. In FundingNavigator.jsx: Accept `onSwitchMode` prop. After the "Search Again" button in the results view, add a cross-tool CTA section:
       - A styled card with Search icon, heading "Know Which Permits You Need?", brief text "Find out which water permits your project requires", and a button "Find Permits →" that calls `onSwitchMode('permits')`.
       - Use existing card styling pattern: `bg-blue-500/10 border border-blue-500/30 rounded-lg p-5`.

    4. In Icons.jsx: No new icons needed — DollarSign and Search already exist.

    Style the CTA buttons as full-width with arrow icon, matching the "Start New Search" / "Search Again" button pattern but with the tool's accent color (cyan for funding CTA, blue for permit CTA).
  </action>
  <verify>
    - Run `npm run build` — no errors
    - In dev mode: navigate Permit Finder to any result → "Explore Funding" CTA visible below restart button → clicking it switches to Funding Navigator
    - In dev mode: complete Funding Navigator questionnaire → results show "Find Permits" CTA → clicking it switches to Permit Finder
  </verify>
  <done>Both tools show cross-tool CTAs on result screens; clicking navigates to the other tool; build passes</done>
</task>

<task type="auto">
  <name>Task 2: Surface related funding programs on result cards</name>
  <files>src/components/FundingNavigator.jsx</files>
  <action>
    When rendering funding result cards in FundingNavigator.jsx, for each matched program that has `relatedPrograms`, check if any of those related program IDs are ALSO in the current matched results (across all tiers). If so, render a small "Related Programs" section below the barriers section (if any) for that card.

    Implementation:
    1. Build a flat lookup of all matched program IDs (from all three tiers) after `matchedPrograms` is computed: `const matchedIds = new Set([...matchedPrograms.eligible, ...matchedPrograms.likelyEligible, ...matchedPrograms.mayQualify].map(p => p.id))`
    2. Also build a name lookup from fundingData.programs: `const nameById = Object.fromEntries(fundingData.programs.map(p => [p.id, p.name]))`
    3. For each rendered program card, filter `program.relatedPrograms` to only those IDs present in `matchedIds`. If any exist, render them as subtle text links below barriers:
       ```
       Related: [Program Name], [Program Name]
       ```
       Style: `text-xs text-slate-500` with program names as `text-slate-400` spans (not clickable — they're already on screen, user can scroll to them).

    Do NOT render related programs that weren't matched (they're irrelevant to this user's criteria).
    Do NOT make this an expandable section — keep it lightweight, just a text line.
  </action>
  <verify>
    - Run `npm run build` — no errors
    - In dev mode: complete Funding Navigator → on result cards, programs with relatedPrograms that also matched show "Related: [names]" text below the card
    - Programs with no matched related programs show no "Related" line
  </verify>
  <done>Matched related programs rendered as text references below funding result cards; only shows programs that appear in current results; build passes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Cross-tool CTAs appear on both Permit Finder and Funding Navigator result screens
- [ ] Clicking CTAs correctly switches between tools
- [ ] Related programs text appears on funding cards where applicable
- [ ] No visual regressions in existing result display
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Permit results link to Funding Navigator
- Funding results link to Permit Finder
- Related funding programs surfaced contextually
</success_criteria>

<output>
After completion, create `.planning/phases/05-integration-polish/05-01-SUMMARY.md`
</output>
