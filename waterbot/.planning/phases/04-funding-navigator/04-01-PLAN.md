---
phase: 04-funding-navigator
plan: 01
type: execute
---

<objective>
Create the FundingNavigator intake questionnaire — a 5-step wizard that collects user eligibility criteria and wires into the WaterBot mode routing.

Purpose: Gather the inputs needed for the matching algorithm (Plan 04-02) using the same component architecture as PermitFinder.
Output: Working FundingNavigator component with 5-step questionnaire, form state, navigation, integrated into WaterBot.jsx.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependency graph):
@.planning/phases/01-shared-infrastructure/01-01-SUMMARY.md
@.planning/phases/01-shared-infrastructure/01-02-SUMMARY.md
@.planning/phases/02-permit-finder/02-01-SUMMARY.md
@.planning/phases/03-funding-data-model/03-02-SUMMARY.md

# Key source files:
@src/components/WizardStepper.jsx
@src/components/PermitFinder.jsx
@src/components/BotHeader.jsx
@src/components/Icons.jsx
@src/pages/WaterBot.jsx

**Tech stack available:** React 18 + Vite + Tailwind, hand-crafted SVG icons, sessionStorage persistence
**Established patterns:**
- PermitFinder owns BotHeader + WizardStepper internally (FundingNavigator follows same pattern)
- WizardStepper fixed mode: pass `steps` array with `content` property → shows "Step X of Y" + progress bar
- Mode routing via React state in WaterBot.jsx

**Constraining decisions:**
- [01-01]: WizardStepper uses controlled component pattern — parent owns currentStep
- [01-02]: Mode routing stays as React state (no react-router)
- [02-01]: Tool components own BotHeader and WizardStepper internally — parent just passes callbacks
- [03-01]: Flat array + filter matching for funding (not tree-based like permits)
- [03-02]: 13 canonical tags for matching consistency

**Data model reference (funding-programs.json eligibility schema):**
- `entityTypes[]`: public-agency, tribe, nonprofit, private-utility, mutual-water-company
- `projectTypes[]`: treatment, distribution, storage, recycling, stormwater, consolidation, emergency, operations, planning
- `dacRequired`: false | true | "preferred"
- `populationMax`: number or null (10 programs have limits)
- `systemSizeMax`: number or null (2 programs have limits)
- `matchRequired`: boolean
- `matchPercentage`: number or null
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FundingNavigator component with intake questionnaire</name>
  <files>src/components/FundingNavigator.jsx</files>
  <action>
Create FundingNavigator.jsx following PermitFinder's architecture pattern (component owns its own BotHeader + WizardStepper).

**Component props:** `{ onAskWaterBot, onBack, sessionId }` — same signature as PermitFinder.

**State:**
- `currentStep` (number, 0-indexed) — controlled by component, passed to WizardStepper
- `answers` object tracking user selections:
  ```
  {
    entityType: null,       // string: 'public-agency' | 'tribe' | 'nonprofit' | 'private-utility' | 'mutual-water-company'
    projectTypes: [],       // string[]: multi-select from 9 project types
    populationServed: null, // string key: 'under-500' | '500-3300' | '3300-10000' | '10000-50000' | 'over-50000'
    dacStatus: null,        // string: 'dac' | 'sdac' | 'no' | 'unsure'
    matchFunds: null        // string: 'yes' | 'limited' | 'no'
  }
  ```
- `showResults` (boolean) — false during questionnaire, true after submission
- `matchedPrograms` (array) — populated by matching algorithm in Plan 04-02 (leave empty for now)

**5 intake steps (define as constant INTAKE_STEPS array):**

Step 0 — "What type of organization are you?"
  Options (single-select, styled as option buttons like PermitFinder):
  - Public Agency (city, county, water district, etc.)
  - Tribal Entity (federally recognized tribe or tribal water system)
  - Nonprofit Organization (community group, conservation org)
  - Private Utility (investor-owned utility)
  - Mutual Water Company (customer-owned water system)

Step 1 — "What type of water project are you planning?"
  Options (multi-select with checkboxes — user may have multiple project types):
  - Drinking Water Treatment
  - Water Distribution / Pipelines
  - Water Storage (tanks, reservoirs)
  - Water Recycling / Reuse
  - Stormwater Management
  - System Consolidation
  - Emergency Repairs
  - Operations & Maintenance
  - Planning & Assessment

Step 2 — "How many people does your water system serve?"
  Options (single-select ranges):
  - Fewer than 500
  - 500 – 3,300
  - 3,300 – 10,000
  - 10,000 – 50,000
  - More than 50,000

Step 3 — "Is your community designated as a Disadvantaged Community (DAC)?"
  Options with helpText explaining DAC:
  - Yes — Disadvantaged Community (DAC)
  - Yes — Severely Disadvantaged Community (SDAC)
  - No
  - Not sure (helpText: "Check at https://gis.water.ca.gov/app/dacs/")

Step 4 — "Can your organization provide matching funds for a grant or loan?"
  Options:
  - Yes — we can match 25% or more
  - Limited — we may be able to provide some match
  - No — we need full funding

**Rendering:**
- Use WizardStepper in FIXED mode: build `steps` array where each step's `content` is the JSX for that question
- Each question step renders option buttons (single-select) or checkbox cards (multi-select for project types)
- Single-select: clicking an option sets the answer AND auto-advances to next step (like PermitFinder's option behavior — no separate "Next" button needed for single-select)
- Multi-select (Step 1 only): show checkbox-style cards + use WizardStepper's "Next" button to advance
- On last step completion: set `showResults = true` (results rendering comes in Plan 04-03)
- Placeholder results view for now: show "Matching programs..." text with the DollarSign icon

**Navigation:**
- `onBack` handler: if currentStep > 0, go back one step and clear that step's answer. If at step 0, call props.onBack (exit to landing)
- `onRestart`: reset currentStep to 0, clear all answers, set showResults to false
- WizardStepper receives: steps array, currentStep, onBack, onRestart, onNext (for multi-select step)

**Styling:** Follow PermitFinder's option button styling exactly (bg-slate-800 hover:bg-slate-700 border border-neutral-700). For multi-select checkboxes, add a cyan check indicator when selected.

**What to avoid:** Do NOT import or use funding-programs.json yet — that's Plan 04-02. Do NOT implement matching logic. The results placeholder is just a "coming in next plan" message. Do NOT use WizardStepper in dynamic mode — use fixed mode with steps array.
  </action>
  <verify>File exists at src/components/FundingNavigator.jsx. Component renders without errors when imported.</verify>
  <done>FundingNavigator renders 5-step questionnaire with single-select and multi-select options, tracks answers in state, navigates forward/back, shows placeholder results view after final step.</done>
</task>

<task type="auto">
  <name>Task 2: Wire FundingNavigator into WaterBot.jsx</name>
  <files>src/pages/WaterBot.jsx</files>
  <action>
Replace the funding mode placeholder in WaterBot.jsx with the real FundingNavigator component:

1. Add import: `import FundingNavigator from '../components/FundingNavigator'`
2. Replace the `if (mode === 'funding')` block (lines ~237-261) with:
   ```
   if (mode === 'funding') {
     return (
       <FundingNavigator
         onAskWaterBot={handleAskWaterBot}
         onBack={() => setMode('choice')}
         sessionId={sessionId}
       />
     )
   }
   ```
   This mirrors the PermitFinder integration pattern exactly.
3. Remove the WizardStepper and DollarSign imports if they're no longer used directly in WaterBot.jsx (check — WizardStepper may still be unused after removing the placeholder). Keep any imports still used by other parts of the file.

**What to avoid:** Do NOT change the PermitFinder integration or chat interface. Do NOT change mode routing logic. Only replace the funding placeholder block.
  </action>
  <verify>`npm run build` succeeds. Navigate to funding mode from landing page — questionnaire renders with 5 steps, back button returns to landing.</verify>
  <done>FundingNavigator integrated into WaterBot mode routing. Selecting "Funding Navigator" from landing shows the intake questionnaire. Back navigation returns to landing. Build passes.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Landing page → Funding Navigator → 5-step questionnaire renders
- [ ] Single-select steps auto-advance on click
- [ ] Multi-select step (project types) uses Next button to advance
- [ ] Back button navigates through steps and back to landing
- [ ] Start Over resets to step 1
- [ ] Answers state tracks selections correctly
- [ ] After final step, placeholder results view shows
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or warnings introduced
- FundingNavigator follows PermitFinder's architectural pattern
- WizardStepper fixed mode works correctly with steps array
</success_criteria>

<output>
After completion, create `.planning/phases/04-funding-navigator/04-01-SUMMARY.md`
</output>
