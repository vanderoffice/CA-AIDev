# Phase 2 Plan 05: CDPH Human Verification & Re-embed

## Overview

Human-verify 19 CDPH (California Dept of Public Health) URLs that return connection errors due to bot protection, then re-embed all modified KiddoBot knowledge files.

## Scope

**Issue Count:** 19 URLs
**Error Type:** All return connection errors (status 0) - bot protection similar to FTB
**Domain:** cdph.ca.gov, www.cdph.ca.gov

## CDPH URLs Requiring Human Verification

| URL | Page Content |
|-----|--------------|
| www.cdph.ca.gov | Main CDPH site |
| www.cdph.ca.gov/Programs/CID/DCDC/Pages/Immunization-Branch.aspx | Immunization Branch |
| cdph.ca.gov/Programs/CID/DCDC/Pages/Immunization-Branch | Same (no www) |
| cdph.ca.gov/Programs/CID/DCDC/Pages/Immunization-Branch.aspx | Same (with extension) |
| www.cdph.ca.gov/Programs/CID/DCDC/Pages/Immunization/School/childcare.aspx | Childcare immunizations |
| cdph.ca.gov/Programs/CID/DCDC/Pages/Immunization/School/childcare.aspx | Same (no www) |
| www.cdph.ca.gov/Programs/CID/DCDC/Pages/Medical-Exemptions.aspx | Medical exemptions |
| cdph.ca.gov/Programs/CID/DCDC/Pages/Medical-Exemptions | Same variations |
| cdph.ca.gov/Programs/CID/DCDC/Pages/Medical-Exemptions.aspx | |
| www.cdph.ca.gov/Programs/CCDPHP/DCDIC/CTCA/Pages/Local-Health-Departments.aspx | Local health depts |
| cdph.ca.gov/Programs/CCDPHP/DCDIC/CTCA/Pages/Local-Health-Departments | Same variations |
| cdph.ca.gov/Programs/CCDPHP/DCDIC/CTCA/Pages/Local-Health-Departments.aspx | |
| cairweb.org | CA Immunization Registry (linked from CDPH) |

## Files Containing CDPH URLs

- 06_State_Agencies/CDPH_Health_Requirements.md (primary file)
- 04_Application_Processes/Immunization_Requirements.md
- 06_State_Agencies/Agency_Coordination_Map.md
- Initial_Assessment/KiddoInterviews_Perplexity.md

## Tasks

### 1. Human Verification (Manual)

Open each URL in a browser and verify:
- [ ] www.cdph.ca.gov loads correctly
- [ ] Immunization Branch page exists at current path
- [ ] Childcare immunization requirements page exists
- [ ] Medical exemptions page exists
- [ ] Local health departments page exists
- [ ] cairweb.org (CA Immunization Registry) is accessible

Document actual working URLs (some may have moved).

### 2. Determine canonical URL format

CDPH likely prefers one format. Determine:
- www vs non-www
- With or without .aspx extension
- Standardize all references to one format

### 3. Apply fixes to affected files

Update all CDPH URLs in:
- CDPH_Health_Requirements.md
- Immunization_Requirements.md
- Agency_Coordination_Map.md
- KiddoInterviews_Perplexity.md

### 4. Re-embed modified KiddoBot files

After all Phase 2 plans complete:

1. Identify all modified .md files:
   ```bash
   git diff --name-only kiddobot/ChildCareAssessment/
   ```

2. Re-chunk modified files

3. Re-embed to Supabase kiddobot_chunks table

4. Verify embeddings loaded correctly

## Re-embedding Process

```bash
# SSH to VPS
ssh root@vanderoffice.com

# Navigate to CA-AIDev
cd /root/CA-AIDev

# Pull latest changes
git pull

# Run embedding script (similar to BizBot process)
python3 scripts/embed-kiddobot.py
```

## Success Criteria

- [ ] All CDPH URLs human-verified
- [ ] Canonical URL format established and applied
- [ ] All modified KiddoBot files committed
- [ ] Files re-embedded to Supabase
- [ ] Embedding count verified

## Estimated Duration

- Human verification: 15 min
- URL updates: 10 min
- Re-embedding: 20 min
- Total: 45 min

## Depends On

02-01, 02-02, 02-03, 02-04 (all other URL fixes complete first)

## Notes

CDPH bot protection is aggressive - similar to FTB. URLs may work fine in browser but fail automated checks. This is expected behavior, not broken links.

The re-embedding step covers ALL Phase 2 changes, not just CDPH fixes. Run this plan last.
