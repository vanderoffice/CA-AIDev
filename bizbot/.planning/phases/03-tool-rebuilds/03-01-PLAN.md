---
phase: 03-tool-rebuilds
plan: 01
type: execute
---

<objective>
Rebuild LicenseFinder from a single-form layout into a guided wizard using WizardStepper, matching the FundingNavigator pattern from WaterBot.

Purpose: The current LicenseFinder dumps all 8+ form fields on one screen — overwhelming for users who don't know what matters. A step-by-step wizard guides them through each decision (industry → structure → location → details) before submitting, matching the proven FundingNavigator UX pattern.
Output: Wizard-style LicenseFinder component integrated into BizBot, calling the same webhook with the same payload.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Auto-selected based on dependency graph:
@.planning/phases/00-audit-baseline/00-01-SUMMARY.md
@.planning/phases/01-knowledge-refresh/01-02-SUMMARY.md

# Key production files (read via SSH before editing):
# /root/vanderdev-website/src/components/bizbot/LicenseFinder.jsx (705 lines — REWRITE TARGET)
# /root/vanderdev-website/src/components/bizbot/LicenseCard.jsx (152 lines — KEEP AS-IS)
# /root/vanderdev-website/src/components/bizbot/IntakeForm.jsx (770 lines — REFERENCE for industry categories, county data)
# /root/vanderdev-website/src/pages/BizBot.jsx (476 lines — MINOR UPDATE)
# /root/vanderdev-website/src/components/WizardStepper.jsx (125 lines — IMPORT AND USE)

# WaterBot reference patterns (dev repo, read-only):
# ~/Documents/GitHub/CA-AIDev/waterbot/src/components/FundingNavigator.jsx (539 lines — STRUCTURAL TEMPLATE)
# ~/Documents/GitHub/CA-AIDev/waterbot/src/components/WizardStepper.jsx (125 lines — SHARED COMPONENT)

**Production-first:** All code changes via `ssh vps` to `/root/vanderdev-website/`. Dev repos are read-only references.

**Tech stack available:** React, WizardStepper (shared component from WaterBot reconciliation), react-markdown + remark-gfm (already imported by LicenseFinder)

**Constraining decisions:**
- [Phase 0]: LicenseFinder has its own react-markdown import separate from shared pipeline — keep for now, Phase 4 unifies
- [Phase 0]: Both WEAK eval scores are off-domain — no knowledge gaps affect tool behavior
- [All]: Production-first doctrine — all edits on VPS via SSH

**Architectural decision (this phase):**
- Skipping `license-requirements.json` frontend data model. The n8n webhook already performs deterministic matching via PostgreSQL `license_requirements` table (250ms response). Duplicating data to a JSON catalog would require sync maintenance for no UX benefit. The wizard collects answers then submits to the existing webhook — same payload, same response.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild LicenseFinder.jsx as wizard-style component</name>
  <files>/root/vanderdev-website/src/components/bizbot/LicenseFinder.jsx</files>
  <action>
  **First:** SSH to VPS and read the current LicenseFinder.jsx, IntakeForm.jsx (for industry category/subcategory data and county arrays), and WizardStepper.jsx (for the reusable wizard shell). Also read FundingNavigator.jsx from the waterbot dev repo locally for structural reference.

  **Then:** Rewrite LicenseFinder.jsx to use WizardStepper with a 5-step questionnaire flow. Structure:

  **Step 0 — Industry Category** (single-select, auto-advance)
  - Show 9 category cards with emoji icons (same categories as IntakeForm: Food & Beverage, Retail, Professional Services, Construction & Trades, Personal Services, Cannabis, Manufacturing, Transportation & Logistics, Other)
  - Each card: icon + label + short description
  - On click: set `industryCategory`, auto-advance to Step 1

  **Step 1 — Specific Industry Type** (single-select, auto-advance)
  - Show subcategories for the selected category (e.g., Food: Restaurant, Food Truck, Catering, Bar/Nightclub, Bakery, Food Manufacturing, Other)
  - Copy the exact subcategory mappings from IntakeForm.jsx's `industryOptions` object
  - On click: set `industry` (e.g., "food_restaurant"), auto-advance to Step 2

  **Step 2 — Business Structure** (single-select, auto-advance)
  - Show 6 entity type cards: Sole Proprietor, LLC, Corporation, S-Corp, Partnership, Nonprofit
  - Each card: icon + label + one-line description (e.g., "LLC — Limited liability, flexible management")
  - On click: set `entityType`, auto-advance to Step 3

  **Step 3 — Location** (dropdowns + toggle, explicit Next button)
  - County dropdown (58 CA counties — reuse array from current LicenseFinder)
  - City dropdown (conditional on county — reuse `getCitiesForCounty()` logic from current component)
  - Home-based business toggle
  - Explicit "Next" button (multiple inputs require manual advance)

  **Step 4 — Business Details** (multi-toggle, Submit button)
  - "Is this a new business?" toggle (default: yes)
  - "Will you have employees?" toggle
  - "Will you sell tangible goods?" toggle
  - Large "Find My Licenses" submit button (orange accent, prominent)
  - On submit: call existing webhook at `https://n8n.vanderdev.net/webhook/bizbot-license-finder` with the same payload shape: `{ industry, entityType, county, city, hasEmployees, sellsTangibleGoods, isHomeBased, isNew }`

  **After submit:** Show loading state, then render results using existing LicenseCard components grouped by phase (formation, state, local, industry, ongoing). Keep the existing results display and "Get Detailed Information" RAG button as-is — Plan 03-02 enhances these.

  **Implementation guidance:**
  - Use WizardStepper in "fixed" mode with `steps` array (like FundingNavigator, NOT dynamic mode like PermitFinder)
  - Track `currentStep` (0-4) and `answers` object in state
  - Auto-advance: for single-select steps, call `setCurrentStep(prev => prev + 1)` in the click handler after setting the answer
  - Back navigation: clear current step's answer, decrement step. On step 0 back, call `onBack()` prop to return to mode choice
  - Keep `autoLinkUrls()` utility function (used in RAG response rendering)
  - Keep LicenseCard import and all results rendering logic
  - Keep `handleGetMoreInfo()` RAG webhook call
  - Do NOT import `getMarkdownComponents` — that's Phase 4 work
  - Match BizBot's orange accent color for active states, buttons, progress bar

  **What to avoid and WHY:**
  - Do NOT extract industry/county data to separate files — keep inline as current LicenseFinder does. Shared data extraction is premature optimization for this phase.
  - Do NOT change the webhook payload shape — the n8n workflow expects exactly `{ industry, entityType, county, city, hasEmployees, sellsTangibleGoods, isHomeBased, isNew }`.
  - Do NOT use the "dynamic" WizardStepper mode (children-based) — use "fixed" mode with steps array for predictable step count and progress bar.
  - Do NOT add new npm dependencies — WizardStepper, react-markdown, remark-gfm are already available.
  </action>
  <verify>ssh vps "cd /root/vanderdev-website && npm run build" succeeds without errors</verify>
  <done>LicenseFinder.jsx renders a 5-step wizard using WizardStepper. Steps 0-2 auto-advance on single-select. Step 3 has explicit Next. Step 4 has Submit button that calls webhook. Results display with LicenseCard groups after successful webhook response. Back navigation works on all steps. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Wire wizard into BizBot.jsx and verify end-to-end</name>
  <files>/root/vanderdev-website/src/pages/BizBot.jsx</files>
  <action>
  **First:** SSH to VPS and read BizBot.jsx to verify the current mode rendering logic.

  The current `mode === 'finder'` branch renders `<LicenseFinder />`. Since we're rewriting LicenseFinder.jsx in-place (same file path, same component name), BizBot.jsx should need minimal changes. Verify:

  1. **Import path unchanged:** `import LicenseFinder from '../components/bizbot/LicenseFinder'` — no change needed if file path is the same.

  2. **Props passed correctly:** The current LicenseFinder receives `onStartChat` and `onBack` props. Ensure the rewritten wizard component accepts and uses these:
     - `onBack` → called when user presses Back on Step 0 (returns to mode choice screen)
     - `onStartChat` → called from results view when user wants to discuss licenses in chat mode (passes business context)

  3. **Mode card description update:** Update the License Finder mode card description from the current text to something reflecting the wizard experience, e.g., "Step-by-step license & permit finder" or "Guided license requirements wizard."

  4. **Mode card icon:** Keep the green accent color. Consider if the icon should change (current is likely Search or FileText — keep as-is unless clearly wrong for a wizard flow).

  5. **End-to-end test via build:** Run `ssh vps "cd /root/vanderdev-website && npm run build"` to confirm no import errors, no missing props, no broken references.

  **What to avoid and WHY:**
  - Do NOT change the mode state values ('choice', 'chat', 'intake', 'finder') — these are persisted in sessionStorage via useBotPersistence and changing them would break existing user sessions.
  - Do NOT modify IntakeForm or chat mode rendering — this plan only touches LicenseFinder and its integration point.
  </action>
  <verify>ssh vps "cd /root/vanderdev-website && npm run build" succeeds. Verify by reading the built output: ssh vps "ls -la /root/vanderdev-website/dist/assets/*.js | head -5" confirms fresh build timestamp.</verify>
  <done>BizBot.jsx renders the wizard-style LicenseFinder when mode === 'finder'. Props (onBack, onStartChat) are passed and used correctly. Mode card description reflects wizard UX. Build succeeds with no errors. Fresh dist/ assets confirm the build completed.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `ssh vps "cd /root/vanderdev-website && npm run build"` succeeds without errors
- [ ] LicenseFinder.jsx uses WizardStepper with 5 steps
- [ ] Steps 0-2 auto-advance on single-select
- [ ] Step 3 has explicit Next button (county/city/home-based)
- [ ] Step 4 has Submit button calling `/webhook/bizbot-license-finder`
- [ ] Webhook payload matches existing format exactly
- [ ] Results render using LicenseCard grouped by phase
- [ ] Back navigation works on all steps
- [ ] BizBot.jsx mode switching (finder ↔ choice ↔ chat) works
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors or warnings introduced
- Wizard flow collects same data as old form, calls same webhook, shows same results
- LicenseCard.jsx and webhook unchanged — only LicenseFinder.jsx and BizBot.jsx modified
</success_criteria>

<output>
After completion, create `.planning/phases/03-tool-rebuilds/03-01-SUMMARY.md`
</output>
