---
phase: 04-ui-polish
plan: 01
type: execute
---

<objective>
Bring BizBot visual presentation to WaterBot standard by wiring remaining response surfaces to the shared markdown pipeline and verifying source pill rendering across all modes. Target: UI parity 42% → 90%+.

Purpose: BizBot's chat mode already renders through the shared ChatMessage component (with getMarkdownComponents, react-markdown, remark-gfm, source pills). The remaining gap is LicenseFinder's RAG response area, which uses bare ReactMarkdown with minimal inline overrides instead of the shared orange-accented components.
Output: All bot response surfaces use getMarkdownComponents('orange'), duplicated code removed, visual parity confirmed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependency graph: Phase 3 directly affects Phase 4)
@.planning/phases/03-tool-rebuilds/03-01-SUMMARY.md
@.planning/phases/03-tool-rebuilds/03-02-SUMMARY.md

# Key source files (on VPS — read via SSH)
# Production repo: /root/vanderdev-website/
# src/components/bizbot/LicenseFinder.jsx — PRIMARY target: swap bare ReactMarkdown for shared components
# src/lib/bots/ChatMessage.jsx — shared component (getMarkdownComponents, source pills)
# src/lib/bots/autoLinkUrls.js — shared URL detection helper
# src/lib/bots/index.js — shared exports barrel
# src/pages/BizBot.jsx — page shell (already uses ChatMessage correctly)
# src/components/bizbot/IntakeForm.jsx — verify: pure form, no markdown needed

**Production-first doctrine:** All code changes via SSH on VPS at /root/vanderdev-website/
**Build command:** ssh vps "cd /root/vanderdev-website && npm run build"

**Tech stack available:** React, Vite, react-markdown, remark-gfm, shared bot component library
**Established patterns:** getMarkdownComponents(accentColor) for consistent markdown rendering, autoLinkUrls for URL preprocessing, ChatMessage for message+source rendering

**Constraining decisions:**
- Phase 3: LicenseFinder already imports ReactMarkdown + remarkGfm directly (line 5-6) — keep these imports, just swap the `components` prop
- Phase 3: LicenseFinder has local autoLinkUrls function (~lines 14-58) — replace with shared import
- Phase 3: PHASE_CONFIG constants pattern established for reusable config

**Issues being addressed:** None from ISSUES.md (ISS-001 is data infrastructure, not UI)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire LicenseFinder RAG response to shared markdown components</name>
  <files>src/components/bizbot/LicenseFinder.jsx</files>
  <action>
  On VPS via SSH, modify /root/vanderdev-website/src/components/bizbot/LicenseFinder.jsx:

  1. Add import for shared getMarkdownComponents:
     `import { getMarkdownComponents } from '../../lib/bots/ChatMessage'`

  2. Add import for shared autoLinkUrls:
     `import { autoLinkUrls } from '../../lib/bots/autoLinkUrls'`

  3. Delete the local `autoLinkUrls` function definition (starts around line 14 with the JSDoc comment "Converts plain URLs and email addresses...", ends around line 58). This is a duplicate of the shared version.

  4. Find the ReactMarkdown usage around line 822 that renders ragResponse. It currently has inline component overrides like:
     `components={{ a: ({...}) => ..., table: ..., th: ..., td: ... }}`
     Replace the inline `components` prop with:
     `components={getMarkdownComponents('orange')}`

  5. Keep the existing `ReactMarkdown` and `remarkGfm` imports (lines 5-6) — LicenseFinder uses them directly for its RAG expansion area, which is separate from the ChatMessage chat rendering path.

  6. Keep the existing `autoLinkUrls(ragResponse)` call in the ReactMarkdown children — it now resolves to the shared version.

  What to AVOID and WHY:
  - Do NOT replace the entire LicenseFinder rendering with ChatMessage. LicenseFinder renders structured wizard results (dashboard, collapsible groups, progress indicator), not chat messages. Only the RAG response expansion area (the "Get More Info" detail text) needs the shared markdown components.
  - Do NOT touch the PHASE_CONFIG/PHASE_COLORS pill system (lines ~214-218). Those pills are for license category/phase badges, not source citations — they serve a different purpose.
  </action>
  <verify>ssh vps "cd /root/vanderdev-website && npm run build" succeeds without errors. grep confirms getMarkdownComponents import exists and local autoLinkUrls function is removed.</verify>
  <done>LicenseFinder uses getMarkdownComponents('orange') for RAG response rendering. Local autoLinkUrls duplicate removed. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Verify remaining rendering surfaces and source pill wiring</name>
  <files>src/components/bizbot/IntakeForm.jsx, src/pages/BizBot.jsx</files>
  <action>
  On VPS via SSH, verify the following:

  1. IntakeForm.jsx — Read the file and confirm it is a data-collection form with NO bot response text rendering. Expected: it collects business information (entity type, industry, location) and passes context to chat mode. If it has NO ReactMarkdown, no ChatMessage, no dangerouslySetInnerHTML, no message.content rendering → document as "confirmed pure form, no markdown needed." If it DOES render any bot response text, wire it to use ChatMessage or getMarkdownComponents('orange').

  2. BizBot.jsx chat mode — Confirm the message object structure includes `sources` array. The existing code at line 160 stores `sources: data.sources || []` on assistant messages. ChatMessage.jsx renders source pills from `message.sources` when the array is non-empty. Confirm this wiring is correct by reading both files. No code changes expected.

  3. ICON_MAP — Read ChatMessage.jsx and verify that icon names (if present in message data) map to SVG components, not raw text strings. If BizBot messages don't use icon data, this is N/A.

  4. Run production build to confirm no regressions from Task 1.
  </action>
  <verify>ssh vps "cd /root/vanderdev-website && npm run build" passes. IntakeForm confirmed as pure form (or fixed if not). Source pill wiring confirmed correct in BizBot → ChatMessage chain.</verify>
  <done>All 3 BizBot response surfaces audited: chat (ChatMessage ✓), LicenseFinder RAG (getMarkdownComponents ✓), IntakeForm (confirmed no markdown needed OR fixed). Build passes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Wired LicenseFinder RAG responses to shared getMarkdownComponents('orange') and verified all rendering surfaces use the shared markdown pipeline</what-built>
  <how-to-verify>
    1. Visit: https://vanderdev.net (navigate to BizBot)
    2. Chat mode: Send "What licenses do I need to open a restaurant in Sacramento?" — verify:
       - Response renders with formatted markdown (headers, bullets, bold)
       - Orange-accented links
       - Source pills appear below the response (colored pill badges, not raw text)
       - Gradient bubble background on bot messages
    3. License Finder mode: Run a search (e.g., Food & Beverage → Restaurant → LLC → Sacramento)
       - If results appear, expand "Get More Info" on any license
       - Verify the RAG expansion text renders with styled markdown (orange headings, styled tables, formatted lists)
       - Note: If no results appear (ISS-001 — missing DB tables), the wizard UX is still correct; RAG expansion won't trigger
    4. Guided Setup mode: Verify the intake form renders correctly (no broken styling)
    5. Compare side-by-side with WaterBot at vanderdev.net — visual consistency in markdown rendering quality
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `ssh vps "cd /root/vanderdev-website && npm run build"` succeeds
- [ ] LicenseFinder uses `getMarkdownComponents('orange')` (not inline overrides)
- [ ] Local `autoLinkUrls` duplicate removed from LicenseFinder
- [ ] Chat mode source pills render correctly
- [ ] All 3 modes visually verified
- [ ] No regressions in existing functionality
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- LicenseFinder RAG responses render with full orange-accented markdown styling
- Source pills display in chat mode when sources are returned
- No duplicate code (local autoLinkUrls removed)
- Visual parity with WaterBot confirmed
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-polish/04-01-SUMMARY.md`
</output>
