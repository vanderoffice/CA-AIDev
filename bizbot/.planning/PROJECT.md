# BizBot Overhaul

## What This Is

Full overhaul of BizBot to WaterBot v2.0 standard: refreshed knowledge base, rebuilt tools, polished UI, comprehensive testing. Generated by `/bot-scaffold` from audit results.

## Core Value

**BizBot users get accurate, current California business licensing information through an intuitive multi-mode interface with 3 specialized tools (Chat, License Expert, License Finder).**

## Requirements

### Validated
- [x] Audit report produced by `/bot-audit` on 2026-02-14
- [ ] Eval baseline captured by `/bot-eval` (Phase 0 deliverable)
- [x] Phase skip/include decisions documented

### Active
- Wire up shared markdown rendering pipeline (`getMarkdownComponents`, `react-markdown`, `remark-gfm`)
- Fix broken/dead URLs in knowledge base (4 dead redirects, 2 dead links, 44 redirects to update)
- Add pill-style source citations to all response surfaces
- Rebuild LicenseFinder with wizard pattern and deterministic matching
- Achieve UI parity with WaterBot standard (42% → 90%+)
- Capture `/bot-eval` embedding baseline in Phase 0
- All webhook endpoints returning structured responses

### Out of Scope
- New bot modes beyond existing 3 (Chat, License Expert, License Finder)
- Database migration or restructuring (DB health is 100/100)
- Custom ML model training
- Mobile native app
- Shared component refactoring (WaterBot already established patterns — BizBot imports them)

## Context

### Current State (from Audit)

**Overall Score:** 74/100

| Category | Score | Status |
|----------|-------|--------|
| Database Health | 100/100 | Clean — 392 chunks, zero dupes, zero NULLs |
| URL Validation | 60/100 | 34 broken + 44 redirects (65.9% healthy) |
| Webhook Health | 70/100 | license-finder 400 is false positive (expects `industry` field) — true score ~90 |
| Knowledge Freshness | 100/100 | All content Jan 2026, zero stale directories |
| UI Parity | 42/100 | Missing markdown pipeline, source pills, shared components |

### Priority Recommendations (from Audit)

**CRITICAL:**
- Wire up markdown rendering pipeline — import `getMarkdownComponents` from `ChatMessage.jsx`, add `react-markdown` + `remark-gfm`. Highest-impact single change.
- Add pill-style source citations — data exists but renders unstyled.
- Fix 4 dead redirects — CSLB pages (Licensing_Timeframes, Renew_A_License, fees) and DGS CASp-Program all redirect to 404s.

**MODERATE:**
- Update `bizbot-license-finder` audit test to send `industry` field (false positive fix).
- Fix `onlineservices.cdtfa.ca.gov` URL — genuinely dead (404).
- Fix `ca.metrc.com` URL — domain changed.
- Update 44 redirected URLs to final destinations.

**LOW:**
- Add timestamp column to DB for chunk-level staleness tracking.
- Enrich metadata on ~60% of chunks still using basic blob format.
- Consider WizardStepper / DecisionTreeView for interactive license finder.
- Bot-blocking 403s (ftb.ca.gov × 14, bizfileonline.sos.ca.gov × 3) — false positives for users.

### Bot Registry

| Property | Value |
|----------|-------|
| DB Table | `public.bizbot_documents` |
| Content Column | `content` |
| Embedding Column | `embedding` |
| Webhooks | `/bizbot`, `/bizbot-licenses`, `/bizbot-license-finder` |
| Knowledge Dir | `~/Documents/GitHub/CA-AIDev/bizbot/BizAssessment/` |
| Accent Color | orange |
| Production File | `/root/vanderdev-website/src/pages/BizBot.jsx` |

### Technical Stack
- **Production repo:** `vanderoffice/vanderdev-website` at `/root/vanderdev-website/`
- **Framework:** React + Vite
- **RAG:** Supabase pgvector (1536-dim, OpenAI text-embedding-3-small)
- **Orchestration:** n8n webhooks at `n8n.vanderdev.net/webhook/`
- **Shared components:** `ChatMessage.jsx`, `DecisionTreeView.jsx`

## Constraints

- **Production-first:** All code changes on VPS via SSH. Dev repos are read-only.
- **Shared components:** Changes to `src/lib/bots/` affect all 3 bots.
- **Regulatory accuracy:** Fee/threshold/eligibility changes require human verification against authoritative sources (DCA, ABC, CSLB, DRE, CalGOLD).
- **Build pipeline:** `ssh vps "cd /root/vanderdev-website && npm run build"` — nginx serves `dist/`.

## Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Production-first doctrine | Dev repo divergence cost WaterBot a full reconciliation phase | All code work on VPS |
| Skip Phase 2 (Shared Infra) | WaterBot already built all shared components; BizBot just imports them | Phase 4 handles wiring |
| Include Phase 1 despite fresh content | URL health at 60% — 34 broken + 44 redirects need remediation | URL-focused knowledge refresh |
