# Milestone v1.0: Overhaul

**Status:** SHIPPED 2026-02-15
**Phases:** 0-6
**Total Plans:** 8

## Overview

Full overhaul of BizBot following the standard 7-phase template. Phases conditionally included based on `/bot-audit` results from 2026-02-14. Target: WaterBot v2.0 feature and quality parity. Production-first doctrine — all code changes on VPS via SSH.

## Domain Expertise

California business licensing, DCA/ABC/CSLB/DRE regulations, CalGOLD local permitting, entity formation (LLC/Corp/Sole Prop), industry-specific licensing (food service, alcohol, construction, cannabis, healthcare, manufacturing, retail, professional services), compliance/renewal cycles, fee schedules.

## Phases

### Phase 0: Audit & Baseline

**Goal**: Establish measurable baseline before any changes.
**Depends on**: None
**Plans**: 1 plan

Plans:

- [x] 00-01: Run embedding eval baseline + snapshot production state + initialize STATE.md

**Details:**
- Embedding eval baseline: 94.3% coverage across 35 queries (29S/4A/2W)
- Production snapshot: 3 active modes, 1,948 LOC across 3 JSX files
- Both WEAK eval scores on intentionally off-domain queries (injection, off-topic) — acceptable
- Duration: 7 min

---

### Phase 1: Knowledge Refresh

**Goal**: Fix broken/dead URLs and update redirects in knowledge base.
**Depends on**: Phase 0
**Plans**: 2 plans

Plans:

- [x] 01-01: URL remediation — replaced 8 dead/redirect URLs across 10 source files
- [x] 01-02: Re-ingest & verify — 387 chunks, 100% coverage (29S/6A/0W)

**Details:**
- Fixed 6 dead URLs (CSLB x3, DGS, CDTFA, Metrc) + 2 redirect URLs (FDA, IRS)
- Documented 22 bot-blocking false positives across 7 domains
- Deduplicated 2 identical preamble chunks from BizInterviews files
- FTB /index.html URLs left as-is (they return 200 directly)
- Duration: 21 min total

---

### Phase 2: Shared Infrastructure (SKIPPED)

**Rationale**: WaterBot already built all shared components (ChatMessage, getMarkdownComponents, autoLinkUrls, WizardStepper). BizBot just imports them. No work needed.

---

### Phase 3: Tool Rebuilds

**Goal**: Rebuild LicenseFinder with deterministic matching and wizard UX.
**Depends on**: Phase 1
**Plans**: 2 plans

Plans:

- [x] 03-01: LicenseFinder wizard rebuild — 5-step guided wizard using WizardStepper
- [x] 03-02: Results enhancement — summary dashboard, collapsible groups, cross-tool CTA

**Details:**
- Deployed WizardStepper.jsx as shared component (was missing from VPS despite claims)
- 9 industry category cards -> subcategory -> entity type -> location -> details
- Summary dashboard with total count, cost range, phase breakdown grid
- Collapsible phase groups with CSS transition animations
- Fixed empty webhook response crash (safe text->JSON parsing)
- ISS-001 logged: missing license_requirements DB tables (resolved in Phase 6)
- Duration: 65 min total

---

### Phase 4: UI/UX Polish

**Goal**: Bring BizBot visual presentation to WaterBot standard (42% -> 90%+).
**Depends on**: Phase 3
**Plans**: 1 plan

Plans:

- [x] 04-01: Wire shared markdown pipeline + remove duplicate autoLinkUrls

**Details:**
- LicenseFinder RAG responses now use getMarkdownComponents('orange')
- Removed 44-line duplicate autoLinkUrls function (now imports shared version)
- All 3 response surfaces verified: Chat (shared ChatMessage), License Finder (shared getMarkdownComponents), Guided Setup (pure form, no markdown needed)
- Source pill wiring confirmed correct
- Duration: 7 min

---

### Phase 5: Integration & E2E Testing

**Goal**: Comprehensive testing of all modes, tools, and cross-tool flows.
**Depends on**: Phase 4
**Plans**: 1 plan

Plans:

- [x] 05-01: Integration eval suite + webhook audit + E2E verification

**Details:**
- Fixed audit webhook false positive (bizbot-license-finder needed industry field in test payload)
- Embedding eval: 100% coverage (29S/6A/0W) — zero regressions
- Webhook audit: 100/100 — all 3 endpoints healthy
- Fixed missing back buttons in LicenseFinder wizard during E2E checkpoint
- WAF 403 on external POST documented as ISS-004 (infrastructure, not webhook issue)
- Duration: 127 min (includes manual browser verification wait)

---

### Phase 6: Production Deploy

**Goal**: Ship it. Verify live.
**Depends on**: Phase 5
**Plans**: 1 plan

Plans:

- [x] 06-01: Final build + human verification + eval close-out

**Details:**
- Production build green (1023 modules, 9.95s)
- Fixed 2 data contract bugs: industry subcategory -> parent code mapping, sole_proprietor -> sole_proprietorship entity type
- ISS-001 resolved: 17 agencies + 31 industry licenses seeded across 9 categories
- Final eval: 29S/6A/0W — 100% coverage, zero regressions
- Duration: 53 min

---

## Milestone Summary

**Key Decisions:**

- Production-first doctrine — all code on VPS via SSH (dev repos read-only)
- Skip Phase 2 — WaterBot shared infra already existed
- Include Phase 1 despite fresh content — URL health at 60% needed remediation
- Both WEAK eval scores acceptable — intentionally off-domain queries
- FTB /index.html URLs left as-is — FTB serves directly (200)
- PHASE_CONFIG constants for reusable results display
- ISS-001 logged not blocking — wizard UX complete without data tables
- WAF 403 is infrastructure — internal access fine
- Industry subcategory -> parent category for DB matching
- Entity type sole_proprietor -> sole_proprietorship for n8n workflow

**Issues Resolved:**

- 6 dead URLs replaced with verified-working alternatives
- 2 duplicate preamble chunks deduplicated
- Empty webhook response crash fixed (safe JSON parsing)
- Audit webhook false positive fixed (per-endpoint test payloads)
- Missing wizard back buttons added
- ISS-001: license_requirements + license_agencies DB tables created and seeded
- Industry code mismatch fixed (subcategory -> parent code)
- Entity type string mismatch fixed

**Issues Deferred:**

- ISS-002: Cross-industry general licenses not auto-included (LOW — SQL change)
- ISS-003: City/county-specific license data not seeded (LOW — data enrichment)
- ISS-004: External POST blocked by nginx WAF (LOW — workaround exists)
- ftb.ca.gov 403s (29 URLs): Bot-blocking WAF, functional in browser
- bizfileonline.sos.ca.gov 403s (3 URLs): Same bot-blocking pattern
- Add timestamp column to DB for chunk-level staleness tracking
- Enrich metadata on ~60% of chunks still using basic blob format

**Technical Debt Incurred:**

- LicenseFinder RAG visual verification partial (depends on license data volume)
- Audit tooling uses VPS-internal docker exec workaround for WAF blocking

---

_For current project status, see .planning/ROADMAP.md_
