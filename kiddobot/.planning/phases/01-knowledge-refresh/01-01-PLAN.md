---
phase: 01-knowledge-refresh
plan: 01
type: execute
---

<objective>
Fix all 48 broken URLs and canonicalize 44 redirected URLs across the KiddoBot knowledge base.

Purpose: Restore URL health from 60/100 to 95%+ before re-ingestion. Broken links in RAG content produce dead-end responses for users.
Output: All 74 knowledge markdown files and 3 CSV database files cleaned of broken/redirected URLs.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/00-audit-baseline/00-01-SUMMARY.md
@.planning/phases/00-audit-baseline/AUDIT-SNAPSHOT.md

# Knowledge base location:
# Markdown files: ChildCareAssessment/ (74 files across 13 directories)
# URL database CSVs: ChildCareAssessment/08_URL_Database/ (agency_urls.csv, program_urls.csv, county_welfare_urls.csv)

**Constraining decisions:**
- Phase 0: Assessment only — no code changes made, baseline captured
- Production-first: Knowledge content lives in dev repo, gets ingested to production via /bot-ingest

**From audit (AUDIT-SNAPSHOT.md) — 48 broken URLs by category:**
- Connection errors (15): autismsocietyca.org, cdrc-childcare.org, cvchn.org, dha.saccounty.gov (2), family-resource.org, iceschildcare.org, inspireschools.org, lassencfr.org, mychildcare.ca.gov, sncs.org, valleyoakcs.org, www.cdph.ca.gov (6), www.delnortechildcare.org, www.mybenefitscalwin.org, www.sbfamilycare.org, www.trintyfamilyresource.org
- 403 Forbidden (11): communityinvestment.lacity.gov, eclkc.ohs.acf.hhs.gov (4), headstart.gov, winnie.com, www.acacamps.org, www.cchealth.org, www.ccrcca.org, www.ftb.ca.gov (2), www.kidsdata.org
- 404 Not Found (5): www.ccld.dss.ca.gov/carefacilitysearch//carefacilitysearch/ (double-path), www.cde.ca.gov/schooldirectory/, www.cde.ca.gov/sp/cd/re/cdcontractorinfo.asp, www.cdss.ca.gov/inforesources/child-care-and-development-licensing, www.rcoe.us (2)
- Timeout (3): www.cde.ca.gov/sp/hs/, www.sandiegocounty.gov (2)
- Malformed (1): www.publichealthlawcenter.org%20Center%20General%20Licensing...

**44 redirected URLs:** Mostly benign www/non-www redirects. Canonicalize to final destinations.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix all 48 broken URLs in knowledge files</name>
  <files>ChildCareAssessment/**/*.md, ChildCareAssessment/08_URL_Database/*.csv</files>
  <action>
Systematic pass through all broken URLs identified in AUDIT-SNAPSHOT.md. For each broken URL:

1. **grep -rl** the URL domain across all ChildCareAssessment/ files to find every occurrence
2. Determine the fix action per category:

**Quick fixes (do first):**
- Typo: `trintyfamilyresource.org` → `trinityfamilyresource.org`
- Malformed: `publichealthlawcenter.org%20Center...` → decode and fix to correct URL (likely `publichealthlawcenter.org`)
- Double-path: `ccld.dss.ca.gov/carefacilitysearch//carefacilitysearch/` → `ccld.dss.ca.gov/carefacilitysearch/`

**403 Forbidden (re-test with GET):**
Many government sites block HEAD requests but work with GET. For each 403 URL:
- `curl -sL -o /dev/null -w "%{http_code}" -A "Mozilla/5.0" [URL]` with full GET
- If 200 with GET: **KEEP** the URL (it works for real browsers)
- If still 403: web search for the correct current URL and replace, or remove if content not essential

**404 Not Found:**
- Web search for the updated URL path on the same domain
- If found: replace with new URL
- If page genuinely removed: remove the URL and note what content was lost

**Connection errors:**
- For `cdph.ca.gov` (6 URLs): test with GET first — entire domain may reject HEAD
- For county/local org sites (autismsocietyca.org, cdrc-childcare.org, etc.): web search for current URL. Many small orgs rebrand or change domains.
- If site is truly dead: remove URL, keep surrounding descriptive text

**Timeouts:**
- Test with longer timeout: `curl -sL -o /dev/null -w "%{http_code}" --max-time 30 [URL]`
- If responds: KEEP (slow but working)
- If still times out: web search for alternative URL

3. Apply each fix in the markdown files AND update the CSV database files in 08_URL_Database/
4. Update `Last_Verified` column in CSVs to `2026-02`

**IMPORTANT:** Do NOT remove URLs silently. If a URL must be removed, keep the surrounding context text (program name, description) so the knowledge isn't lost — only the dead link is removed.
  </action>
  <verify>
grep -rn "trintyfamilyresource" ChildCareAssessment/ returns 0 results
grep -rn "carefacilitysearch//carefacilitysearch" ChildCareAssessment/ returns 0 results
grep -rn "publichealthlawcenter.org%20" ChildCareAssessment/ returns 0 results
  </verify>
  <done>All 48 broken URLs triaged and fixed (replaced, corrected, or removed with context preserved). Quick-fix URLs (typo, malformed, double-path) confirmed clean. 403 URLs re-tested with GET. CSV database files updated.</done>
</task>

<task type="auto">
  <name>Task 2: Canonicalize 44 redirected URLs to final destinations</name>
  <files>ChildCareAssessment/**/*.md, ChildCareAssessment/08_URL_Database/*.csv</files>
  <action>
For each of the 44 redirected URLs identified in the audit:

1. Resolve each to its final destination:
   `curl -sL -o /dev/null -w "%{url_effective}" [URL]`

2. Common redirect patterns to expect:
   - `http://` → `https://` (always canonicalize to https)
   - `example.com` → `www.example.com` (or vice versa)
   - Old path → new path (e.g., page restructuring)

3. For each redirected URL:
   - grep -rl to find all occurrences in ChildCareAssessment/
   - Replace with the final canonical URL
   - Update CSVs in 08_URL_Database/ with canonical URL

4. Skip canonicalization if:
   - The redirect is temporary (302/307) — keep original
   - The final URL is a different page entirely (investigate first)

**Batch approach for efficiency:**
- Extract all unique redirected URLs
- curl each to get final destination
- Build a sed replacement map
- Apply across all files

Update `Last_Verified` to `2026-02` for all updated CSV entries.
  </action>
  <verify>
Pick 10 random canonicalized URLs from the edited files and curl them — all should return 200 with no redirect chain.
  </verify>
  <done>All 44 redirected URLs canonicalized to final destinations. No redirect chains remain in knowledge files. CSV database updated with canonical URLs.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] grep for known broken patterns returns 0 results (typo, malformed, double-path)
- [ ] Spot-check 10 URLs from formerly-broken list — all return 2xx
- [ ] Spot-check 10 URLs from formerly-redirected list — all return 2xx with no redirect
- [ ] CSV files in 08_URL_Database/ have updated Last_Verified dates
- [ ] No knowledge content was silently deleted (only dead links removed, text preserved)
</verification>

<success_criteria>

- All 48 broken URLs resolved (fixed, replaced, or removed with context preserved)
- All 44 redirected URLs canonicalized to final destinations
- Knowledge files and CSV database in sync
- URL health ready for re-validation in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/01-knowledge-refresh/01-01-SUMMARY.md`
</output>
