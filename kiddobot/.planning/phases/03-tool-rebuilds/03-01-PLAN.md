---
phase: 03-tool-rebuilds
plan: 01
type: execute
---

<objective>
Extract hardcoded income thresholds from EligibilityCalculator into a data-driven JSON config and refactor the component to load from it.

Purpose: Hardcoded SMI/FPL values break every fiscal year. JSON config enables easy annual updates without touching component code.
Output: `kiddobot-thresholds.json` data file + refactored EligibilityCalculator loading from it.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/01-knowledge-refresh/01-02-SUMMARY.md

# Key files (on VPS — read via SSH):
# /root/vanderdev-website/src/components/kiddobot/EligibilityCalculator.jsx — current hardcoded thresholds
# /root/vanderdev-website/src/data/kiddobot-program-tree.json — existing data file pattern

**Production-first:** All file operations via `ssh vps "..."`. Dev repo is read-only.

**Tech stack available:** React + Vite, JSON imports via Vite bundler (import works natively)

**Constraining decisions:**
- Phase 1: Verified 2025-26 SMI/FPL/MBSAC thresholds against CDE MB 25-05, HHS 2026 Federal Register, CDSS ACL 25-36
- Roadmap: Data-driven thresholds in JSON, not hardcoded
- Roadmap: No changes to shared components (ChatMessage.jsx, DecisionTreeView.jsx)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create kiddobot-thresholds.json data file</name>
  <files>/root/vanderdev-website/src/data/kiddobot-thresholds.json</files>
  <action>
Create a JSON file on VPS at `src/data/kiddobot-thresholds.json` containing:

1. **metadata** object:
   - `effectiveDate`: "2025-07-01" (FY 2025-26 start)
   - `nextReviewDate`: "2026-07-01" (when to check for new values)
   - `sources`: array of source citations (CDE MB 25-05, HHS 2026 Federal Register)
   - `lastVerified`: "2026-02-16"

2. **incomeLimits** object — extract EXACTLY from the current `INCOME_LIMITS` constant in EligibilityCalculator.jsx:
   - `SMI_85`: {1: 4929, 2: 6446, 3: 7962, 4: 9479, 5: 10996, 6: 12512, 7: 12796, 8: 13079}
   - `SMI_100`: {1: 5799, 2: 7583, 3: 9367, 4: 11151, 5: 12936, 6: 14720, 7: 15054, 8: 15388}
   - `SMI_75`: {1: 4349, 2: 5687, 3: 7026, 4: 8363, 5: 9702, 6: 11040, 7: 11290, 8: 11541}
   - `FPL_100`: {1: 1255, 2: 1703, 3: 2151, 4: 2599, 5: 3047, 6: 3495, 7: 3943, 8: 4391}
   - `FPL_130`: {1: 1632, 2: 2214, 3: 2796, 4: 3379, 5: 3961, 6: 4544, 7: 5126, 8: 5708}

3. **counties** array — extract the 58 county names from `CALIFORNIA_COUNTIES` constant.

Use JSON keys as strings for family sizes ("1" through "8") since JSON doesn't support integer keys.

Do NOT invent or recalculate values — copy exactly from the current component.
  </action>
  <verify>ssh vps "cat /root/vanderdev-website/src/data/kiddobot-thresholds.json | python3 -c 'import json,sys; d=json.load(sys.stdin); print(\"Keys:\", list(d.keys())); print(\"SMI_85[4]:\", d[\"incomeLimits\"][\"SMI_85\"][\"4\"]); print(\"Counties:\", len(d[\"counties\"]))'"</verify>
  <done>JSON file exists with 5 threshold tables, 58 counties, metadata section. SMI_85 family-of-4 = 9479.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor EligibilityCalculator to load from JSON</name>
  <files>/root/vanderdev-website/src/components/kiddobot/EligibilityCalculator.jsx</files>
  <action>
Refactor EligibilityCalculator.jsx on VPS:

1. **Add import** at top: `import thresholdData from '../../data/kiddobot-thresholds.json'`

2. **Replace `INCOME_LIMITS` constant** with: `const INCOME_LIMITS = thresholdData.incomeLimits`
   - The rest of the component references INCOME_LIMITS.SMI_85[size] etc. — this works because JSON keys are strings and JS coerces `size` (an integer) to string for property access.

3. **Replace `CALIFORNIA_COUNTIES` constant** with: `const CALIFORNIA_COUNTIES = thresholdData.counties`

4. **Update the file header comment** to note thresholds are now loaded from JSON.

5. **Update the disclaimer text** at bottom of results — change "based on 2025-26 income limits" to reference the metadata: `Based on income limits effective ${thresholdData.metadata.effectiveDate}` (format the date nicely in the JSX).

Do NOT change:
- The `calculateEligibility` function logic
- The form layout or styling
- The ProgramCard rendering
- Any props interface (onBack, onLearnMore)

The refactor should be purely structural — same behavior, data externalized.
  </action>
  <verify>ssh vps "cd /root/vanderdev-website && npm run build 2>&1 | tail -5" — must succeed with no errors. Then grep the built output to confirm thresholds are bundled: ssh vps "grep -c '9479' /root/vanderdev-website/dist/assets/*.js" should return >= 1.</verify>
  <done>EligibilityCalculator imports from JSON. No hardcoded INCOME_LIMITS or CALIFORNIA_COUNTIES. Build succeeds. Same visual output.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `ssh vps "cd /root/vanderdev-website && npm run build"` succeeds
- [ ] `kiddobot-thresholds.json` exists with correct structure
- [ ] EligibilityCalculator.jsx has no hardcoded threshold values
- [ ] grep for `SMI_85:` in EligibilityCalculator.jsx returns 0 (constants removed)
- [ ] grep for `import.*thresholdData` in EligibilityCalculator.jsx returns 1
</verification>

<success_criteria>

- Thresholds externalized to JSON config
- EligibilityCalculator loads from JSON — identical behavior
- Build passes on VPS
- No hardcoded income limits remain in component code
</success_criteria>

<output>
After completion, create `.planning/phases/03-tool-rebuilds/03-01-SUMMARY.md`
</output>
