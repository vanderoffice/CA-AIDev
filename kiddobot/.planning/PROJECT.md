# KiddoBot Overhaul

## What This Is

Full overhaul of KiddoBot to WaterBot v2.0 standard: refreshed knowledge base, rebuilt tools, polished UI, comprehensive testing. Generated by `/bot-scaffold` from audit results.

## Core Value

**KiddoBot users get accurate, current information about California childcare programs through an intuitive multi-mode interface with 3 specialized tools (Chat, EligibilityCalculator, ProgramFinder).**

## Requirements

### Validated
- [x] Audit report produced by `/bot-audit` on 2026-02-16
- [ ] Eval baseline captured by `/bot-eval` (to be run in Phase 0)
- [x] Phase skip/include decisions documented

### Active
- Fix 48 broken URLs in RAG knowledge base (19% of all URLs)
- Refactor EligibilityCalculator to data-driven thresholds (JSON config, not hardcoded)
- Enhance ProgramFinder with county-aware matching
- Integrate `react-markdown` + `remark-gfm` + `getMarkdownComponents('pink')` on all response surfaces
- Add pill-style source citations matching WaterBot standard
- Add responsive layout CSS
- Achieve `/bot-eval` coverage >= 80%

### Out of Scope
- New bot modes beyond existing 3 (calculator, personalized, programs)
- Spatial/GIS features (flagged in knowledge base but not prioritized)
- Changes to shared `ChatMessage.jsx` behavior (only import and use existing API)
- n8n workflow redesign (webhooks are healthy at 100/100)

## Context

### Current State (from Audit)

**Overall Score:** 84/100

| Category | Score | Status |
|----------|-------|--------|
| Database Health | 100/100 | Clean — 1,390 chunks, zero dupes/nulls |
| URL Validation | 60/100 | 48 broken URLs (connection errors, 403s, 404s) |
| Webhook Health | 100/100 | Both endpoints responding |
| Knowledge Freshness | 100/100 | 81 files, 113K words, all <30 days old |
| UI Parity | 58/100 | Missing 4/6 WaterBot standard components |

### Priority Recommendations (from Audit)

**CRITICAL:**
- 48 broken URLs: 15 connection errors, 11 forbidden, 5 not-found, 3 timeouts, 1 malformed
- UI missing: `getMarkdownComponents`, `WizardStepper`, `react-markdown`, `remark-gfm`
- No pill-style source citations
- No responsive layout

**MODERATE:**
- None — all non-critical categories scored 100/100

**LOW:**
- Main chat webhook latency at 7.45s — monitor for degradation
- No source metadata column in DB for chunk traceability
- 44 redirected URLs (benign www/non-www redirects, consider canonicalizing)
- 3 slow URLs (data.ca.gov, irs.treasury.gov, childcarelaw.org)

### Bot Registry

| Property | Value |
|----------|-------|
| DB Table | `kiddobot.document_chunks` |
| Content Column | `chunk_text` |
| Embedding Column | `embedding` |
| Webhooks | `/kiddobot`, `/kiddobot-programs` |
| Knowledge Dir | `~/Documents/GitHub/CA-AIDev/kiddobot/ChildCareAssessment/` |
| Accent Color | pink |
| Production File | `/root/vanderdev-website/src/pages/KiddoBot.jsx` |

### Technical Stack
- **Production repo:** `vanderoffice/vanderdev-website` at `/root/vanderdev-website/`
- **Framework:** React + Vite
- **RAG:** Supabase pgvector (1536-dim, OpenAI text-embedding-3-small)
- **Orchestration:** n8n webhooks at `n8n.vanderdev.net/webhook/`
- **Shared components:** `ChatMessage.jsx`, `DecisionTreeView.jsx`

## Constraints

- **Production-first:** All code changes on VPS via SSH. Dev repos are read-only.
- **Shared components:** Changes to `src/lib/bots/` affect all 3 bots.
- **Regulatory accuracy:** Fee/threshold/eligibility changes require human verification against authoritative sources (CDSS, CDE, federal poverty guidelines).
- **Build pipeline:** `ssh vps "cd /root/vanderdev-website && npm run build"` — nginx serves `dist/`.

## Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Production-first doctrine | Dev repo divergence cost WaterBot a full reconciliation phase | All work on VPS |
| Skip Phase 2 (Shared Infrastructure) | WaterBot already built shared components; KiddoBot just needs to import them | Phase 4 handles imports |
| Data-driven thresholds for EligibilityCalculator | Hardcoded SMI/FPL values break every fiscal year | JSON config on VPS, easy to update |
