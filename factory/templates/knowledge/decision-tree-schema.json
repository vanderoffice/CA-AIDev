{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Decision Tree Schema",
  "description": "Standard schema for bot decision trees used by DecisionTreeView component. Derived from WaterBot permit-decision-tree.json and funding-decision-tree.json.",
  "type": "object",
  "required": ["version", "metadata", "nodes"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Semantic version of the decision tree content",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "lastUpdated": {
      "type": "string",
      "description": "ISO date when the tree content was last revised",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "examples": ["2025-01-16"]
    },
    "metadata": {
      "type": "object",
      "required": ["title", "description"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Display title shown in the UI header",
          "examples": ["California Water Permit Finder"]
        },
        "description": {
          "type": "string",
          "description": "Brief description of what this decision tree helps with"
        },
        "disclaimer": {
          "type": "string",
          "description": "Legal/accuracy disclaimer shown to users"
        }
      },
      "additionalProperties": false
    },
    "nodes": {
      "type": "object",
      "description": "Map of node IDs to node definitions. Must contain a 'start' node.",
      "patternProperties": {
        "^[a-z][a-z0-9_]*$": {
          "oneOf": [
            { "$ref": "#/definitions/questionNode" },
            { "$ref": "#/definitions/resultNode" }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "definitions": {
    "questionNode": {
      "type": "object",
      "description": "A decision point that presents options to the user",
      "required": ["id", "type", "title", "options"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique node identifier matching its key in the nodes object",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "type": {
          "type": "string",
          "const": "question"
        },
        "title": {
          "type": "string",
          "description": "The question text displayed to the user",
          "minLength": 1
        },
        "helpText": {
          "type": "string",
          "description": "Additional context shown below the question to guide the user's choice"
        },
        "options": {
          "type": "array",
          "description": "Available choices for this question",
          "items": { "$ref": "#/definitions/option" },
          "minItems": 2
        }
      },
      "additionalProperties": false
    },
    "resultNode": {
      "type": "object",
      "description": "A terminal node showing the outcome/recommendation",
      "required": ["id", "type", "title", "description"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique node identifier matching its key in the nodes object",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "type": {
          "type": "string",
          "const": "result"
        },
        "title": {
          "type": "string",
          "description": "Result heading displayed to the user",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Detailed explanation of the result or recommendation"
        },
        "ragQuery": {
          "type": "string",
          "description": "Optional query string sent to RAG search for supplementary context"
        },
        "links": {
          "type": "array",
          "description": "Optional external resource links related to this result",
          "items": { "$ref": "#/definitions/link" }
        }
      },
      "additionalProperties": false
    },
    "option": {
      "type": "object",
      "description": "A selectable choice within a question node",
      "required": ["id", "label", "next"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique option identifier within this question",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "label": {
          "type": "string",
          "description": "Short label displayed on the option button",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Additional detail shown below the label"
        },
        "icon": {
          "type": "string",
          "description": "Material icon name for visual identification",
          "examples": ["construction", "factory", "water_drop", "eco", "agriculture"]
        },
        "next": {
          "type": "string",
          "description": "ID of the node to navigate to when this option is selected. Must reference an existing key in the nodes object.",
          "pattern": "^[a-z][a-z0-9_]*$"
        }
      },
      "additionalProperties": false
    },
    "link": {
      "type": "object",
      "description": "An external resource link shown on result nodes",
      "required": ["label", "url"],
      "properties": {
        "label": {
          "type": "string",
          "description": "Display text for the link"
        },
        "url": {
          "type": "string",
          "description": "Target URL",
          "format": "uri"
        }
      },
      "additionalProperties": false
    }
  }
}
