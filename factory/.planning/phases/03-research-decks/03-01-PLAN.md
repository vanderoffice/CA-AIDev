---
phase: 03-research-decks
plan: 01
type: execute
---

<objective>
Create the multi-perspective research orchestration skill (research-domain.md) that dispatches 5 parallel subagents to analyze a government domain, then synthesizes findings into triple output: stakeholder brief, developer assessment, and Memory entities.

Purpose: Every factory project starts with research. This skill standardizes the "understand the domain" step so every bot/form project begins with the same depth of analysis — regulatory, stakeholder, technical, fiscal, and existing-systems perspectives.
Output: `~/.claude/commands/gov-factory/research-domain.md` skill file + two output templates in `factory/templates/decks/`
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (dependency graph):
@.planning/phases/01-foundation/01-03-SUMMARY.md

# Existing deck skill (research pipeline to build on):
@~/.claude/commands/deck/SKILL.md
@~/.claude/commands/deck/scripts/research.js
@~/.claude/commands/deck/templates/research-output.md

# Knowledge template (research-to-knowledge target format):
@factory/templates/knowledge/TEMPLATE.md

**Tech stack available:** Perplexity MCP (perplexity_research, perplexity_search), Memory MCP (create_entities, create_relations, add_observations), Task tool (subagent_type: general-purpose, Explore), llm-gateway MCP
**Established patterns:** sed-based {{PLACEHOLDER}} substitution in templates, 7-field YAML frontmatter for knowledge docs, H2 = chunk boundary
**Constraining decisions:**
- [01-03]: Knowledge authoring standard — 7-field YAML frontmatter, H2 = chunk boundary, 500-1500 char target per section
- [01-03]: Research-to-knowledge conversion must produce docs compatible with chunk-knowledge.js
- [02-01]: sed-based template substitution with {{PLACEHOLDER}} pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create research-domain.md skill</name>
  <files>~/.claude/commands/gov-factory/research-domain.md</files>
  <action>
Create the gov-factory research-domain skill as a Claude Code command markdown file. The skill should:

1. **Accept a domain argument** — e.g., `/gov-factory:research-domain "water rights permitting"` with optional `--depth quick|standard|deep` flag (default: standard).

2. **Dispatch 5 parallel subagents** via the Task tool (subagent_type: "general-purpose") — each with a distinct perspective prompt:
   - **Regulatory** — What laws, regulations, codes, SAMs govern this domain? Who enforces? What are the compliance requirements? Use Perplexity MCP for current regulatory landscape.
   - **Stakeholder** — Who are the end users? What are their pain points? What's the current manual process? What would automation change for them?
   - **Technical** — What existing systems/databases exist? What APIs are available? What data formats? What's the integration landscape?
   - **Fiscal** — What's the budget context? Cost of current process? Potential savings? Funding sources or constraints?
   - **Existing Systems** — What CA state systems already touch this domain? What's been tried before? What open-source or COTS solutions exist?

   Each subagent should use `mcp__perplexity__perplexity_research` (standard/deep) or `mcp__perplexity__perplexity_search` (quick) and return structured findings as markdown.

3. **Synthesize into triple output:**
   - **Stakeholder brief** — Executive-friendly markdown (2-3 pages). Problem statement, current state, opportunity, key risks, recommendation. Saved to project output dir as `{domain-slug}-stakeholder-brief.md`. Use the stakeholder-brief.md template from `factory/templates/decks/`.
   - **Developer assessment** — Technical markdown (3-5 pages). Architecture considerations, data sources, integration points, RAG suitability, recommended approach, risk registry. Saved as `{domain-slug}-developer-assessment.md`. Use the developer-assessment.md template from `factory/templates/decks/`.
   - **Memory entities** — Create entities in Memory MCP: domain entity (name, description, status), regulation entities, stakeholder entities, system entities. Create relations between them (domain HAS regulation, domain SERVES stakeholder, domain USES system).

4. **Skill structure:**
   - Use standard Claude Code skill format (markdown with instructions Claude follows)
   - Include `<required_tools>` section listing Perplexity, Memory, Task MCPs
   - Include `<output_format>` section with file naming conventions
   - Reference the output templates via @-paths
   - Do NOT write JavaScript — this is a prompt/instruction file that Claude reads and executes

5. **What to avoid and WHY:**
   - Do NOT make subagents depend on each other — they must run in parallel for speed
   - Do NOT hardcode Perplexity model names — use the depth flag to select tool (search vs research)
   - Do NOT create Memory entities without domain prefix — use `{domain}_` prefix for all entity names to avoid collisions
   - Do NOT skip the synthesis step — raw subagent outputs need consolidation, not concatenation
  </action>
  <verify>
    - File exists at ~/.claude/commands/gov-factory/research-domain.md
    - File contains 5 perspective definitions (regulatory, stakeholder, technical, fiscal, existing-systems)
    - File references Task tool with subagent_type
    - File references Perplexity MCP tools
    - File references Memory MCP create_entities/create_relations
    - File contains triple output specification (brief, assessment, memory)
  </verify>
  <done>Skill file exists, references all 5 perspectives, all 3 output formats, and all required MCP tools. Claude can read and execute it without clarifying questions.</done>
</task>

<task type="auto">
  <name>Task 2: Create research output templates</name>
  <files>factory/templates/decks/stakeholder-brief.md, factory/templates/decks/developer-assessment.md</files>
  <action>
Create two markdown templates that the research-domain skill fills after synthesis:

**stakeholder-brief.md** — Executive-facing document:
```
# {{DOMAIN_TITLE}}: Stakeholder Brief

> Prepared: {{DATE}}
> Domain: {{DOMAIN_SLUG}}

## Executive Summary
{{EXECUTIVE_SUMMARY}}

## Current State
{{CURRENT_STATE}}

## The Opportunity
{{OPPORTUNITY}}

## Key Risks
{{KEY_RISKS}}

## Recommendation
{{RECOMMENDATION}}

## Next Steps
{{NEXT_STEPS}}

---
*Generated by Government Automation Factory*
```

**developer-assessment.md** — Technical-facing document:
```
# {{DOMAIN_TITLE}}: Developer Assessment

> Prepared: {{DATE}}
> Domain: {{DOMAIN_SLUG}}

## Architecture Overview
{{ARCHITECTURE_OVERVIEW}}

## Data Sources
{{DATA_SOURCES}}

## Integration Points
{{INTEGRATION_POINTS}}

## RAG Suitability
{{RAG_SUITABILITY}}

## Recommended Approach
### Track: {{RECOMMENDED_TRACK}}
{{APPROACH_DETAIL}}

## Risk Registry
| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
{{RISK_ROWS}}

## Estimated Complexity
{{COMPLEXITY_ASSESSMENT}}

## Dependencies
{{DEPENDENCIES}}

---
*Generated by Government Automation Factory*
```

Both templates should:
- Use {{PLACEHOLDER}} convention matching scaffold.sh pattern (02-01 decision)
- Be self-contained — each section has enough heading context for Claude to fill without ambiguity
- Include the `---` horizontal rules that /deck uses as slide boundaries (so these can optionally feed into presentation generation)
- Keep sections sized for eventual knowledge conversion (500-1500 chars per section aligns with 01-03 knowledge template standard)
  </action>
  <verify>
    - Both files exist in factory/templates/decks/
    - All placeholders use {{UPPER_SNAKE_CASE}} format
    - stakeholder-brief.md has: Executive Summary, Current State, Opportunity, Key Risks, Recommendation, Next Steps
    - developer-assessment.md has: Architecture, Data Sources, Integration, RAG Suitability, Approach, Risk Registry, Complexity, Dependencies
    - Both use --- slide boundary markers
  </verify>
  <done>Two template files exist with all required sections, placeholder format matches factory convention, section sizes are knowledge-conversion-compatible.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `~/.claude/commands/gov-factory/research-domain.md` exists and is well-structured
- [ ] `factory/templates/decks/stakeholder-brief.md` exists with all sections
- [ ] `factory/templates/decks/developer-assessment.md` exists with all sections
- [ ] Skill file references both templates via @-paths
- [ ] No hardcoded values — all domain-specific content uses placeholders
</verification>

<success_criteria>

- research-domain.md skill file is complete and executable by Claude
- Both output templates exist with {{PLACEHOLDER}} convention
- Skill dispatches 5 parallel subagents with distinct perspective prompts
- Triple output format specified (stakeholder brief, developer assessment, Memory entities)
- Templates are compatible with /deck slide boundaries and knowledge template section sizes
</success_criteria>

<output>
After completion, create `.planning/phases/03-research-decks/03-01-SUMMARY.md`
</output>
