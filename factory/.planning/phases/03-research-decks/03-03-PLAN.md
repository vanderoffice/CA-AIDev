---
phase: 03-research-decks
plan: 03
type: execute
---

<objective>
Create the research-to-knowledge conversion skill and the factory SKILL.md index that catalogs all factory skills with their references.

Purpose: Close the loop between research and RAG — research findings become structured knowledge documents that feed the RAG pipeline (chunk → embed → validate). The SKILL.md index makes the factory self-documenting for future phases.
Output: `~/.claude/commands/gov-factory/research-to-knowledge.md` skill file + `~/.claude/commands/gov-factory/SKILL.md` index
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/03-research-decks/03-01-SUMMARY.md
@.planning/phases/03-research-decks/03-02-SUMMARY.md

# Knowledge template (target format for conversion):
@factory/templates/knowledge/TEMPLATE.md

# RAG pipeline scripts (downstream consumers of knowledge docs):
@factory/scripts/chunk-knowledge.js
@factory/scripts/embed-chunks.py
@factory/scripts/validate-knowledge.py

# Research output templates (source format for conversion):
@factory/templates/decks/stakeholder-brief.md
@factory/templates/decks/developer-assessment.md

# Existing deck skill for reference structure:
@~/.claude/commands/deck/SKILL.md

**Tech stack available:** chunk-knowledge.js (Node.js, zero deps), embed-chunks.py (OpenAI text-embedding-3-small, pgvector), validate-knowledge.py (6-check quality gate)
**Established patterns:** Knowledge TEMPLATE.md (7-field YAML frontmatter, H2 = chunk boundary, 500-1500 char/section), content_hash UNIQUE for dedup, schema-per-project
**Constraining decisions:**
- [01-02]: Zero npm deps for chunker — Node.js stdlib only
- [01-02]: content_hash UNIQUE constraint for dedup (skip-duplicates, not truncate)
- [01-03]: Knowledge authoring standard — 7-field YAML frontmatter, H2 = chunk boundary, 500-1500 char target
- [01-03]: BizBot uses same standard table schema — no special columns
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create research-to-knowledge.md skill</name>
  <files>~/.claude/commands/gov-factory/research-to-knowledge.md</files>
  <action>
Create the research-to-knowledge conversion skill that transforms research outputs (stakeholder brief + developer assessment) into knowledge documents compatible with the RAG pipeline.

The skill should:

1. **Accept arguments** — domain slug (required), optional `--output-dir` (defaults to project's `knowledge/` directory).

2. **Locate research outputs** — Find `{domain-slug}-stakeholder-brief.md` and `{domain-slug}-developer-assessment.md`. Error if not found.

3. **Convert to knowledge documents** — Transform research sections into knowledge TEMPLATE.md format:

   **Mapping rules (stakeholder brief → knowledge doc):**
   - Frontmatter: title = "{Domain} Overview", domain = "{domain-slug}", category = "overview", subcategory = "stakeholder-analysis", source_authority = extracted from research, source_urls = Perplexity citations, last_verified = today
   - H1 = domain title
   - Executive Summary → H2 "Overview" section
   - Current State → H2 "Current State" section
   - The Opportunity → H2 "Automation Opportunity" section
   - Key Risks → H2 "Risk Factors" section
   - Recommendation → H2 "Recommended Approach" section

   **Mapping rules (developer assessment → knowledge doc):**
   - Frontmatter: title = "{Domain} Technical Assessment", domain = "{domain-slug}", category = "technical", subcategory = "architecture-assessment", source_authority/urls/verified same pattern
   - Architecture Overview → H2 "Architecture Overview" section
   - Data Sources → H2 "Data Sources" section
   - Integration Points → H2 "Integration Points" section
   - RAG Suitability → H2 "RAG Pipeline Fit" section
   - Recommended Approach → H2 "Implementation Approach" section
   - Risk Registry → H2 "Technical Risks" section

4. **Enforce knowledge template constraints:**
   - Each H2 section: 500-1500 chars. If research section exceeds 1500, split into multiple H2 sections with descriptive titles.
   - If research section under 100 chars, merge with adjacent section or expand with context.
   - Strip :::chart, :::diagram, :::collapse syntax (not compatible with chunker).
   - Preserve inline citations as source_urls in frontmatter.
   - Strip presentation formatting (bold metrics, slide notes) — knowledge docs are for RAG retrieval, not human reading.

5. **Output files:**
   - `{domain-slug}-overview.md` (from stakeholder brief)
   - `{domain-slug}-technical.md` (from developer assessment)
   - Both saved to `--output-dir` or project `knowledge/` directory

6. **Validate output** — After writing, run conceptual validation:
   - All 7 frontmatter fields present
   - No H2 section exceeds 2000 chars
   - No empty H2 sections
   - No :::custom blocks remain

7. **What to avoid and WHY:**
   - Do NOT preserve presentation formatting — :::chart blocks break chunk-knowledge.js which processes plain markdown only
   - Do NOT concatenate sections without H2 boundaries — the chunker splits on H2, so missing boundaries mean one giant chunk with poor retrieval
   - Do NOT invent content — only transform what exists in research outputs. If a section is empty, note it as "No data available from research" rather than fabricating
   - Do NOT duplicate the chunk/embed/validate pipeline — this skill produces knowledge DOCUMENTS, the existing scripts handle the rest
  </action>
  <verify>
    - File exists at ~/.claude/commands/gov-factory/research-to-knowledge.md
    - Skill references factory/templates/knowledge/TEMPLATE.md format
    - Skill includes mapping rules for both stakeholder brief and developer assessment
    - Skill enforces 500-1500 char section size constraint
    - Skill strips :::custom blocks
    - Skill validates 7-field frontmatter on output
    - Output file naming uses {domain-slug}-overview.md and {domain-slug}-technical.md
  </verify>
  <done>Skill file exists, maps both research output formats to knowledge template format, enforces all chunker constraints, and produces RAG-pipeline-ready documents.</done>
</task>

<task type="auto">
  <name>Task 2: Create factory SKILL.md index</name>
  <files>~/.claude/commands/gov-factory/SKILL.md</files>
  <action>
Create the SKILL.md index for the gov-factory skill collection. This serves as the entry point that Claude reads to understand what factory skills are available and how they relate.

Structure following the /deck SKILL.md pattern:

```markdown
---
name: gov-factory
description: "Government Automation Factory — standardized pipeline from domain research to deployed application on vanderdev.net. Orchestrates research, presentations, knowledge base creation, scaffolding, and deployment."
---

# Government Automation Factory

## Overview
[Brief description of the factory pipeline]

## Skills

### research-domain
[Description, invocation, output]

### build-decks
[Description, invocation, output]

### research-to-knowledge
[Description, invocation, output]

## Pipeline Flow
[Diagram showing: research-domain → build-decks → research-to-knowledge → (scaffold → build → deploy)]

## References Index
[Links to templates, scripts, and docs — serves as <references_index> for future GSD planning]
```

The references index section should catalog:
- All factory templates (knowledge/, decks/, gsd/, bot/, form/)
- All factory scripts (chunk-knowledge.js, embed-chunks.py, validate-knowledge.py, scaffold.sh, migrate-rag-tables.sql)
- All skill files (research-domain.md, build-decks.md, research-to-knowledge.md)
- Key reference projects (WaterBot, ECOS, vanderdev-website paths)

This file is critical for Phase 7 (factory orchestrator) — it's how the orchestrator discovers available skills. It's also used by GSD plan-phase when loading domain expertise.
  </action>
  <verify>
    - File exists at ~/.claude/commands/gov-factory/SKILL.md
    - YAML frontmatter has name and description
    - All 3 skills documented (research-domain, build-decks, research-to-knowledge)
    - References index covers templates, scripts, and skills
    - Pipeline flow shows skill execution order
  </verify>
  <done>SKILL.md index exists with all skills documented, references indexed, and pipeline flow specified. Claude can read this file to discover all factory capabilities.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `~/.claude/commands/gov-factory/research-to-knowledge.md` exists and follows knowledge template constraints
- [ ] `~/.claude/commands/gov-factory/SKILL.md` exists with all skills indexed
- [ ] research-to-knowledge maps both research output formats correctly
- [ ] SKILL.md references index is comprehensive (all templates, scripts, skills)
- [ ] No circular dependencies between skills
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- research-to-knowledge skill produces knowledge docs compatible with chunk-knowledge.js
- SKILL.md catalogs all factory skills and references
- Phase 3 complete — research → decks → knowledge pipeline fully specified
</success_criteria>

<output>
After completion, create `.planning/phases/03-research-decks/03-03-SUMMARY.md`:

Include "Phase 3 complete" in success criteria since this is the last plan in the phase.
</output>
