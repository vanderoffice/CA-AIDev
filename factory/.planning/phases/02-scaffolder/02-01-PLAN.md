---
phase: 02-scaffolder
plan: 01
type: execute
---

<objective>
Create the project scaffolder script and CLAUDE.md templates for both bot and form tracks.

Purpose: One command bootstraps a new government automation project with the correct directory structure, GSD config, and project-specific CLAUDE.md — eliminating the manual setup that currently takes 30+ minutes per project.
Output: scaffold.sh script, bot-CLAUDE.md.template, form-CLAUDE.md.template
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 1 context (direct dependency):
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

# Existing factory structure to understand what scaffold.sh populates:
@factory/README.md
@factory/.env.example
@factory/templates/knowledge/TEMPLATE.md

# Reference projects — these are the REAL projects the templates generalize from:
@/Users/slate/Documents/GitHub/CA-AIDev/waterbot/CLAUDE.md
@/Users/slate/Documents/GitHub/Automation/ECOS/CLAUDE.md

**Tech stack available:** shell (bash), GSD conventions
**Established patterns:**
- CLI flag pattern: required flags with clear --help (from 01-02 chunk-knowledge.js)
- .env.example uses Tailscale IP placeholder (from 01-01)
- schema-per-project naming: {schema}.document_chunks (from 01-02)
- Knowledge template: 7-field YAML frontmatter, H2 = chunk boundary (from 01-03)
- Directory structure mirrors 7-phase build order (from 01-01)

**Constraining decisions:**
- [01-01]: Factory lives at factory/ within CA-AIDev/factory/ repo root
- [01-02]: All DB/API creds via env vars exclusively — zero hardcoded values
- [01-03]: Knowledge authoring standard established — scaffolder should reference it, not redefine it
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scaffold.sh</name>
  <files>factory/scripts/scaffold.sh</files>
  <action>
Create a bash script at factory/scripts/scaffold.sh that bootstraps a new project.

**Usage:**
```
./scaffold.sh --track bot --name waterbot --title "Water Rights Assistant"
./scaffold.sh --track form --name calfire --title "CalFire Reporting"
```

**Required flags:** --track (bot|form), --name (slug, lowercase, no spaces), --title (display name in quotes)
**Optional flags:** --output-dir (override default parent directory)

**Validation:**
- All three required flags must be present (print usage and exit 1 if missing)
- --track must be "bot" or "form"
- --name must be lowercase alphanumeric + hyphens only (regex: ^[a-z][a-z0-9-]*$)
- Target directory must not already exist (exit with error if it does)

**Bot track** creates at `${OUTPUT_DIR:-/Users/slate/Documents/GitHub/CA-AIDev}/${NAME}/`:
```
${NAME}/
├── knowledge/
│   └── README.md           # "Place domain knowledge .md files here"
├── scripts/                # Symlinks to factory pipeline scripts
│   ├── chunk-knowledge.js  → ../../factory/scripts/chunk-knowledge.js (RELATIVE symlink)
│   ├── embed-chunks.py     → ../../factory/scripts/embed-chunks.py
│   └── validate-knowledge.py → ../../factory/scripts/validate-knowledge.py
├── research/
│   └── .gitkeep
├── decks/
│   └── .gitkeep
├── .planning/
│   ├── PROJECT.md          # Skeleton with {{TITLE}}, {{NAME}} filled in
│   ├── ROADMAP.md          # Placeholder: "Run /gsd:create-roadmap or copy from factory/templates/gsd/bot-ROADMAP.md"
│   ├── STATE.md            # Initial state (Phase 0, not started)
│   └── config.json         # {"mode": "interactive", "depth": "standard", ...}
├── CLAUDE.md               # From bot-CLAUDE.md.template with substitutions
└── README.md               # Project README with title, track type, quick start
```

**Form track** creates at `${OUTPUT_DIR:-/Users/slate/Documents/GitHub/Automation}/${NAME}/`:
```
${NAME}/
├── sql/
│   └── .gitkeep
├── src/
│   └── .gitkeep
├── research/
│   └── .gitkeep
├── decks/
│   └── .gitkeep
├── .planning/
│   ├── PROJECT.md
│   ├── ROADMAP.md          # Placeholder: "Run /gsd:create-roadmap or copy from factory/templates/gsd/form-ROADMAP.md"
│   ├── STATE.md
│   └── config.json
├── CLAUDE.md               # From form-CLAUDE.md.template with substitutions
└── README.md
```

**Symlink strategy for bot track scripts:** Use relative symlinks so the project is portable. Calculate the relative path from `${NAME}/scripts/` back to `factory/scripts/`. If --output-dir is the default CA-AIDev parent, the relative path is `../../factory/factory/scripts/` (because factory repo is at CA-AIDev/factory/ and the actual scripts are in factory/factory/scripts/). Handle this by computing the relative path dynamically or documenting the assumption.

IMPORTANT: Do NOT use `realpath` or `readlink -f` (not portable on macOS stock bash). Use a simple relative path calculation or just document the expected directory layout.

**Template substitution:** Use sed to replace these placeholders in copied templates:
- `{{PROJECT_NAME}}` → --name value
- `{{PROJECT_TITLE}}` → --title value
- `{{SCHEMA_NAME}}` → --name value (same as name, used for Supabase schema)
- `{{TRACK}}` → --track value
- `{{CREATED_DATE}}` → $(date +%Y-%m-%d)

**PROJECT.md skeleton** (generated inline, not from a template file):
```markdown
# {{PROJECT_TITLE}}

## What This Is
[Describe the project]

## Core Value
[What problem this solves]

## Requirements
### Active
- [ ] [First requirement]

### Out of Scope
- [Items explicitly excluded]

## Context
**Track:** {{TRACK}}
**Schema:** {{SCHEMA_NAME}}
**Created:** {{CREATED_DATE}}

## Constraints
- Deploy to vanderdev.net VPS
- Schema: {{SCHEMA_NAME}}.document_chunks for RAG data
- Follow factory standards (see CA-AIDev/factory/README.md)

## Key Decisions
| Decision | Rationale | Outcome |
|----------|-----------|---------|
```

**config.json:** Same structure as factory's own config.json (copy the pattern from .planning/config.json).

**STATE.md skeleton:**
```markdown
# Project State

## Current Position
Phase: 0 of 9
Status: Not started
Last activity: {{CREATED_DATE}} — Project scaffolded

## Accumulated Context
### Decisions
None yet.
### Deferred Issues
None.
### Blockers/Concerns
None.
```

Print a summary on success:
```
✓ Scaffolded {{TRACK}} project: {{PROJECT_TITLE}}
  Location: /path/to/project
  Next: cd /path/to/project && review CLAUDE.md, then /gsd:create-roadmap
```
  </action>
  <verify>
bash factory/scripts/scaffold.sh --help prints usage without error.
shellcheck factory/scripts/scaffold.sh passes (or note any intentional exceptions).
  </verify>
  <done>scaffold.sh exists, handles --help, validates flags, exits on bad input</done>
</task>

<task type="auto">
  <name>Task 2: Create CLAUDE.md templates</name>
  <files>factory/templates/bot-CLAUDE.md.template, factory/templates/form-CLAUDE.md.template</files>
  <action>
Create two CLAUDE.md template files with {{PLACEHOLDER}} substitution markers.

**factory/templates/bot-CLAUDE.md.template:**

```markdown
# {{PROJECT_TITLE}} — Bot Project

> **Session Start:** Query memory for `{{PROJECT_NAME}}_Session_Handoff`

## Project

- **Track:** Bot (vanderdev-website SPA page)
- **Schema:** {{SCHEMA_NAME}}
- **Factory:** CA-AIDev/factory/ (shared scripts, templates)
- **Location:** This directory

## Pipeline

research → presentations → knowledge base → RAG ingest → n8n workflows → frontend → deploy → final decks

## Key Paths

| Path | Purpose |
|------|---------|
| knowledge/ | Domain knowledge markdown files |
| scripts/ | Symlinks to factory RAG pipeline |
| research/ | Domain research outputs |
| decks/ | Presentation deck outputs |
| .planning/ | GSD project state |

## Standards

- **Knowledge docs:** Follow factory/templates/knowledge/TEMPLATE.md (7-field YAML frontmatter, H2 = chunk boundary)
- **RAG table:** {{SCHEMA_NAME}}.document_chunks
- **Embedding:** text-embedding-3-small, 1536 dims
- **DB creds:** Via env vars only (see factory/.env.example)

## Session End

Save to memory:
- Entity: {{PROJECT_NAME}}_Session_Handoff
- Include: current phase/plan, what was done, what's next, any blockers

## DO NOT

- Hardcode database credentials or IPs
- Create custom RAG scripts (use factory pipeline)
- Skip memory query at session start
- End session without saving handoff to memory
```

**factory/templates/form-CLAUDE.md.template:**

```markdown
# {{PROJECT_TITLE}} — Form Project

> **Session Start:** Query memory for `{{PROJECT_NAME}}_Session_Handoff`

## Project

- **Track:** Form (standalone Docker container)
- **Schema:** {{SCHEMA_NAME}}
- **Factory:** CA-AIDev/factory/ (shared templates)
- **Location:** This directory

## Pipeline

research → presentations → database schema → API layer → UI → deploy → final decks

## Key Paths

| Path | Purpose |
|------|---------|
| sql/ | Database migrations |
| src/ | Application source code |
| research/ | Domain research outputs |
| decks/ | Presentation deck outputs |
| .planning/ | GSD project state |

## Standards

- **Schema:** One Supabase schema per project ({{SCHEMA_NAME}})
- **API:** Supabase PostgREST
- **Frontend:** React + Tailwind (vanderdev.net design system)
- **Deploy:** Docker multi-stage build, docker-compose.prod.yml
- **DB creds:** Via env vars only

## Session End

Save to memory:
- Entity: {{PROJECT_NAME}}_Session_Handoff
- Include: current phase/plan, what was done, what's next, any blockers

## DO NOT

- Hardcode database credentials or IPs
- Skip memory query at session start
- End session without saving handoff to memory
- Use React Router basename in navigate() paths (relative to base only)
```

Both templates should be clean markdown with no extraneous comments — these become the actual CLAUDE.md for each project.
  </action>
  <verify>
Both template files exist and contain {{PROJECT_NAME}}, {{PROJECT_TITLE}}, {{SCHEMA_NAME}} placeholders.
grep -c '{{' on each file returns expected placeholder count.
  </verify>
  <done>Two CLAUDE.md templates exist with correct placeholders, track-specific content, and factory standards</done>
</task>

<task type="auto">
  <name>Task 3: Test scaffold for both tracks</name>
  <files>(no files created — verification only)</files>
  <action>
Run scaffold.sh in a temp directory to verify both tracks produce correct output.

**Test 1: Bot track**
```bash
TMPDIR=$(mktemp -d)
bash factory/scripts/scaffold.sh --track bot --name testbot --title "Test Bot" --output-dir "$TMPDIR"
```
Verify:
- Directory $TMPDIR/testbot/ exists
- knowledge/README.md exists
- scripts/ contains 3 symlinks (chunk-knowledge.js, embed-chunks.py, validate-knowledge.py)
- research/.gitkeep exists
- decks/.gitkeep exists
- .planning/PROJECT.md contains "Test Bot" (not {{PROJECT_TITLE}})
- .planning/ROADMAP.md exists
- .planning/STATE.md exists
- .planning/config.json is valid JSON
- CLAUDE.md contains "testbot" and "Test Bot" (no remaining {{placeholders}})
- README.md exists

**Test 2: Form track**
```bash
bash factory/scripts/scaffold.sh --track form --name testform --title "Test Form" --output-dir "$TMPDIR"
```
Verify same structure minus symlinks, plus sql/ and src/ directories.

**Test 3: Error cases**
- Missing --name flag → exits with usage message
- Duplicate directory → exits with error
- Invalid name (uppercase, spaces) → exits with error

**Cleanup:** `rm -rf "$TMPDIR"` after all tests pass.

If any test fails, fix scaffold.sh and re-run. Do not proceed with failures.
  </action>
  <verify>All three test groups pass. Print summary of checks passed.</verify>
  <done>scaffold.sh produces correct output for both tracks, rejects bad input, and cleans up</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] scaffold.sh exists and is executable
- [ ] Both CLAUDE.md templates exist with correct placeholders
- [ ] Bot scaffold produces correct directory tree with symlinks
- [ ] Form scaffold produces correct directory tree
- [ ] Placeholder substitution works (no remaining {{...}} in output)
- [ ] Error handling works for missing flags, bad names, existing directories
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- scaffold.sh handles both tracks correctly
- Templates use consistent placeholder naming
- No hardcoded paths that break portability (except documented defaults)
</success_criteria>

<output>
After completion, create `.planning/phases/02-scaffolder/02-01-SUMMARY.md`
</output>
