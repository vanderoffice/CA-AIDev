---
phase: 05-bot-frontend
plan: 02
type: execute
---

<objective>
Create factory bot page template and decision tree template with {{PLACEHOLDER}} tokens for scaffold.sh integration.

Purpose: Enable `scaffold.sh --track bot` to produce a working bot page skeleton by sed-replacing placeholders — the same pattern used by n8n templates (Phase 4) and CLAUDE.md templates (Phase 2).
Output: PageComponent.jsx.template + DecisionTree.json.template in factory/templates/bot/.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-bot-frontend/05-01-SUMMARY.md

Factory templates (for pattern reference):
@/Users/slate/Documents/GitHub/CA-AIDev/factory/factory/templates/bot-CLAUDE.md.template
@/Users/slate/Documents/GitHub/CA-AIDev/factory/factory/n8n-templates/README.md

Phase 1 decision tree schema (template must conform to this):
@/Users/slate/Documents/GitHub/CA-AIDev/factory/factory/templates/knowledge/decision-tree-schema.json

WaterBot as quality reference:
@/Users/slate/Documents/GitHub/vanderdev-website/src/pages/WaterBot.jsx

Shared components from Plan 05-01:
@/Users/slate/Documents/GitHub/vanderdev-website/src/lib/bots/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PageComponent.jsx.template</name>
  <files>
    /Users/slate/Documents/GitHub/CA-AIDev/factory/factory/templates/bot/PageComponent.jsx.template
  </files>
  <action>
    Create a WaterBot-quality bot page template using {{PLACEHOLDER}} tokens that scaffold.sh will sed-replace.

    **Required placeholders** (matching existing factory conventions from Phase 2/4):
    - {{BOT_NAME}} — display name (e.g., "WaterBot", "HousingBot")
    - {{BOT_SLUG}} — lowercase identifier (e.g., "waterbot", "housingbot")
    - {{BOT_DESCRIPTION}} — one-line tagline for the choice screen
    - {{BOT_ICON}} — Icon component name from Icons.jsx (e.g., "Droplets", "Home")
    - {{SCHEMA_NAME}} — Supabase schema (e.g., "waterbot", "housing")
    - {{CHAT_WEBHOOK_URL}} — n8n chat orchestrator webhook endpoint
    - {{TOOL_WEBHOOK_URL}} — n8n tool/RAG webhook endpoint (for decision tree RAG button)
    - {{PRIMARY_COLOR}} — Tailwind accent color class (e.g., "blue", "emerald", "orange")

    **Template structure** (derived from WaterBot pattern):
    1. Imports: React, shared components from `../lib/bots/` (ChatMessage, DecisionTreeView, RAGButton, autoLinkUrls), BotHeader, useBotPersistence, Icons
    2. Component function: `{{BOT_NAME}}Page`
    3. State: useBotPersistence hook with bot slug prefix
    4. Choice screen: 3 mode options — "Ask {{BOT_NAME}}" (chat), "{{TOOL_NAME}}" (decision tree tool), custom third option placeholder
    5. Intake form slot: `import IntakeForm from '../components/{{BOT_SLUG}}/IntakeForm'` — the intake form is always bot-specific, never shared
    6. Chat mode: Uses BotChatInterface pattern — message list with ChatMessage, input bar, empty state with suggested questions placeholder
    7. Tool mode: Uses DecisionTreeView with imported decision tree JSON, RAGButton wired to {{TOOL_WEBHOOK_URL}}
    8. Webhook call: fetch to {{CHAT_WEBHOOK_URL}} with session ID, message, and bot context

    **What NOT to include:**
    - No inline autoLinkUrls (use import from lib/bots/)
    - No inline decision tree navigation logic (use DecisionTreeView)
    - No hardcoded bot-specific content — everything is a placeholder or import
    - Do NOT template the IntakeForm itself (too domain-specific; stays in bot directory)

    Include comments explaining each placeholder and which factory artifact populates it.
  </action>
  <verify>
    - File exists at factory/templates/bot/PageComponent.jsx.template
    - Contains all 8 required placeholders
    - Imports shared components from ../lib/bots/
    - Has choice screen, chat mode, tool mode, and intake form import
    - No hardcoded bot-specific content (no "water", "business", "kiddo" references)
    - Comments document each placeholder's purpose and source
  </verify>
  <done>
    - Template produces a valid JSX page component after placeholder replacement
    - All shared components from 05-01 are imported (not reimplemented)
    - Intake form is referenced as an import (not inlined), acknowledging it's always custom
    - Placeholder convention matches Phase 2 (CLAUDE.md) and Phase 4 (n8n) templates
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DecisionTree.json.template</name>
  <files>
    /Users/slate/Documents/GitHub/CA-AIDev/factory/factory/templates/bot/DecisionTree.json.template
  </files>
  <action>
    Create a parameterized decision tree JSON template conforming to the factory's decision-tree-schema.json (from Phase 1, Plan 3).

    **Schema compliance** (from decision-tree-schema.json):
    - Top level: `meta` object + `nodes` object
    - meta: title, description, version, lastUpdated
    - Node types: questionNode (title, helpText?, options[]) and resultNode (title, description, ragQuery?, links?)
    - Options: id, label, next (referencing another node key)

    **Template structure:**
    ```json
    {
      "meta": {
        "title": "{{BOT_NAME}} {{TOOL_NAME}}",
        "description": "Decision tree for {{BOT_DESCRIPTION}}",
        "version": "1.0.0",
        "lastUpdated": "{{CREATED_DATE}}"
      },
      "nodes": {
        "start": { question node with 3 example options },
        "option-a": { question node showing branching },
        "option-b": { result node showing outcome pattern },
        "result-detail": { result node with ragQuery and links }
      }
    }
    ```

    Include 4-6 example nodes demonstrating both question and result node types, with ragQuery examples on result nodes and links arrays. Use {{PLACEHOLDER}} tokens for bot-specific values (names, descriptions). Add JSON comments via a `_comment` field in meta explaining the template.

    This template is what gets copied into a new bot project's `src/data/` directory and populated with domain-specific decision logic.
  </action>
  <verify>
    - File exists at factory/templates/bot/DecisionTree.json.template
    - Valid JSON structure (ignoring {{PLACEHOLDER}} tokens which break JSON parsing)
    - Conforms to decision-tree-schema.json: has meta + nodes, proper node types
    - Contains both questionNode and resultNode examples
    - Result nodes include ragQuery and links examples
    - Uses {{PLACEHOLDER}} convention for bot-specific values
  </verify>
  <done>
    - Template demonstrates full decision tree structure including branching, results, RAG queries, and external links
    - Conforms to factory's decision-tree-schema.json (Phase 1)
    - Uses same {{PLACEHOLDER}} convention as all other factory templates
    - Provides enough example nodes that a developer understands the pattern without reading docs
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both files exist in factory/templates/bot/
- [ ] PageComponent.jsx.template uses shared lib/bots/ imports (not inline implementations)
- [ ] DecisionTree.json.template follows decision-tree-schema.json structure
- [ ] All placeholders use {{DOUBLE_BRACE}} convention
- [ ] No bot-specific hardcoded values in either template
</verification>

<success_criteria>

- 2 template files created in factory/templates/bot/
- PageComponent.jsx.template is WaterBot-quality with all domain content replaced by placeholders
- DecisionTree.json.template conforms to the Phase 1 JSON Schema
- Both templates use the factory's established {{PLACEHOLDER}} convention
- Templates are documented with inline comments explaining each placeholder
</success_criteria>

<output>
After completion, create `.planning/phases/05-bot-frontend/05-02-SUMMARY.md`
</output>
